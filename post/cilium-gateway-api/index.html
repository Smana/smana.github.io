<!doctype html><html lang=en data-figures class=page><head><title>`Gateway API`: Can I replace my Ingress Controller with `Cilium`? | Ogenki</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=XXXXXXXXXX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","XXXXXXXXXX")</script><meta property="og:locale" content="en"><meta property="og:locale:alternate" content="fr"><meta property="og:type" content="article"><meta name=description content="Cilium supports features typically provided by Ingress controllers through the implementation of the Gateway API standard. An introduction and a practical …"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@smana.dev"><meta name=twitter:title content="`Gateway API`: Can I replace my Ingress Controller with `Cilium`?"><meta name=twitter:image content="https://blog.ogenki.io/post/cilium-gateway-api/thumbnail.png"><meta property="og:url" content="https://blog.ogenki.io/post/cilium-gateway-api/"><meta property="og:title" content="`Gateway API`: Can I replace my Ingress Controller with `Cilium`?"><meta property="og:description" content="Cilium supports features typically provided by Ingress controllers through the implementation of the Gateway API standard. An introduction and a practical …"><meta property="og:image" content="https://blog.ogenki.io/post/cilium-gateway-api/thumbnail.png"><meta name=keywords content="kubernetes,infrastructure,network"><link rel=apple-touch-icon sizes=180x180 href=https://blog.ogenki.io/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.ogenki.io/icons/favicon-32x32.png><link rel=manifest href=https://blog.ogenki.io/icons/site.webmanifest><link rel=canonical href=https://blog.ogenki.io/post/cilium-gateway-api/><link rel=preload href=https://blog.ogenki.io/css/styles.a556cef0edd8ecd9821e661f7f201d84cc18d0c6435703889db2949aea0eccb84b7ac9a2bb49093b03f5e7d9ce21c23c705efd6dcbd7e8018afae9a9f32ca095.css integrity="sha512-pVbO8O3Y7NmCHmYffyAdhMwY0MZDVwOInbKUmuoOzLhLesmiu0kJOwP159nOIcI8cF79bcvX6AGK+ump8yyglQ==" as=style crossorigin=anonymous><link rel=preload href=https://blog.ogenki.io/en/js/bundle.fb0be5bcaafc43d845951fd0966e48e5a7bf36be99ce2176c89d369bb5a8136dfb14e596d145cfa04c4c3b79232ffffd811a01eccee956d9d61cf49330e633c7.js as=script integrity="sha512-+wvlvKr8Q9hFlR/Qlm5I5ae/Nr6ZziF2yJ02m7WoE237FOWW0UXPoExMO3kjL//9gRoB7M7pVtnWHPSTMOYzxw==" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://blog.ogenki.io/css/styles.a556cef0edd8ecd9821e661f7f201d84cc18d0c6435703889db2949aea0eccb84b7ac9a2bb49093b03f5e7d9ce21c23c705efd6dcbd7e8018afae9a9f32ca095.css integrity="sha512-pVbO8O3Y7NmCHmYffyAdhMwY0MZDVwOInbKUmuoOzLhLesmiu0kJOwP159nOIcI8cF79bcvX6AGK+ump8yyglQ==" crossorigin=anonymous></head><body data-code=21 data-lines=false id=documentTop data-lang=en><header class=nav_header><nav class=nav><a href=https://blog.ogenki.io/ class="nav_brand nav_item" title=Ogenki><img src=https://blog.ogenki.io/logos/logo.png class=logo alt=Ogenki><div class=nav_close><div><svg class="icon"><title>open-menu</title><use xlink:href="#open-menu"/></svg>
<svg class="icon"><title>closeme</title><use xlink:href="#closeme"/></svg></div></div></a><div class='nav_body nav_body_left'><div class=nav_parent><a href=https://blog.ogenki.io/ class=nav_item title=Home>Home</a></div><div class=nav_parent><a href=https://blog.ogenki.io/ class=nav_item title=Links>Links <img src=https://blog.ogenki.io/icons/caret-icon.svg alt=icon class=nav_icon></a><div class=nav_sub><span class=nav_child></span>
<a href=https://bsky.app/profile/smana.dev class="nav_child nav_item" title=Bluesky>Bluesky</a>
<a href=https://www.linkedin.com/in/sma%C3%AFne-kahlouch-44374110/ class="nav_child nav_item" title=LinkedIn>LinkedIn</a></div></div><div class=nav_parent><a href=https://blog.ogenki.io/about/ class=nav_item title=About>About</a></div><div class=nav_parent><a href=# class=nav_item>🌐</a><div class=nav_sub><span class=nav_child></span>
<a href=https://blog.ogenki.io/ class="nav_child nav_item">English</a>
<a href=https://blog.ogenki.io/fr/ class="nav_child nav_item">Français</a></div></div><div class=follow><a href=https://github.com/Smana><svg class="icon"><title>github</title><use xlink:href="#github"/></svg>
</a><a href=https://www.linkedin.com/in/sma%C3%AFne-kahlouch-44374110/><svg class="icon"><title>linkedin</title><use xlink:href="#linkedin"/></svg>
</a><a href=https://bsky.app/profile/smana.dev><svg class="icon"><title>bluesky</title><use xlink:href="#bluesky"/></svg></a><div class=color_mode><input type=checkbox class=color_choice id=mode></div></div></div></nav></header><main><div class="grid-inverse wrap content"><article class=post_content><h1 class=post_title><code>Gateway API</code>: Can I replace my Ingress Controller with <code>Cilium</code>?</h1><div class=post_meta><span><svg class="icon"><title>calendar</title><use xlink:href="#calendar"/></svg>
</span><span class=post_date>17-09-2023</span>
<span class=post_time>· 15 min read</span><span>&nbsp;· <a href=https://blog.ogenki.io/tags/kubernetes/ title=kubernetes class="post_tag button button_translucent">kubernetes
</a><a href=https://blog.ogenki.io/tags/infrastructure/ title=infrastructure class="post_tag button button_translucent">infrastructure
</a><a href=https://blog.ogenki.io/tags/network/ title=network class="post_tag button button_translucent">network
</a></span><span class=page_only>&nbsp;·<div class=post_share>Share on:
<a href="https://twitter.com/intent/tweet?text=%60Gateway%20API%60%3a%20Can%20I%20replace%20my%20Ingress%20Controller%20with%20%60Cilium%60%3f&url=https%3a%2f%2fblog.ogenki.io%2fpost%2fcilium-gateway-api%2f&tw_p=tweetbutton" class=twitter title="Share on Twitter" target=_blank rel=nofollow><svg class="icon"><title>twitter</title><use xlink:href="#twitter"/></svg>
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.ogenki.io%2fpost%2fcilium-gateway-api%2f&t=%60Gateway%20API%60%3a%20Can%20I%20replace%20my%20Ingress%20Controller%20with%20%60Cilium%60%3f" class=facebook title="Share on Facebook" target=_blank rel=nofollow><svg class="icon"><title>facebook</title><use xlink:href="#facebook"/></svg>
</a><a href=#linkedinshare id=linkedinshare class=linkedin title="Share on LinkedIn" rel=nofollow><svg class="icon"><title>linkedin</title><use xlink:href="#linkedin"/></svg>
</a><a href=https://blog.ogenki.io/post/cilium-gateway-api/ title="Copy Link" class="link link_yank"><svg class="icon"><title>copy</title><use xlink:href="#copy"/></svg></a></div></span></div><div class=post_toc><h2>Overview</h2><nav id=TableOfContents><ul><li><a href=#-our-target>🎯 Our target</a></li><li><a href=#-introduction-to-gateway-api>☸ Introduction to Gateway API</a></li><li><a href=#ballot_box_with_check-prerequisites>&#9745;&#xfe0f; Prerequisites</a></li><li><a href=#-the-entry-point-gatewayclass-and-gateway>🚪 The Entry Point: GatewayClass and Gateway</a></li><li><a href=#arrow_right_hook-routing-rules-httproute>&#8618;&#xfe0f; Routing rules: HTTPRoute</a><ul><li><a href=#a-basic-rule>A basic rule</a></li><li><a href=#configure-a-tls-certificate>Configure a TLS certificate</a></li><li><a href=#sharing-a-gateway-accross-multiple-namespaces>Sharing a Gateway accross multiple namespaces</a></li><li><a href=#traffic-splitting>Traffic splitting</a></li><li><a href=#headers-modifications>Headers modifications</a></li></ul></li><li><a href=#-assign-the-proper-permissions>🔒 Assign the proper permissions</a></li><li><a href=#-a-somewhat-unclear-scope-at-first-glance>🤔 A somewhat unclear scope at first glance</a></li><li><a href=#-final-thoughts>💭 Final thoughts</a></li><li><a href=#-references>🔖 References</a></li></ul></nav></div><div class=post_body><p>When deploying an application on Kubernetes, the next step usually involves making it accessible to users. We commonly use <a href=https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/><strong>Ingress controllers</strong></a>, such as Nginx, Haproxy, Traefik, or those from Cloud providers, to direct incoming traffic to the application, manage load balancing, TLS termination, and more.</p><p>Then we have to choose from the plethora of <a href=https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/>available options</a> 🤯. Cilium is, relatively recently, one of them and aims to handle all these networking aspects.</p><p><a href=https://cilium.io/><strong>Cilium</strong></a> is an Open-Source networking and security solution based on eBPF whose adoption is growing rapidly. It's probably the network plugin that provides the most features. We won't cover all of them, but one such feature involves managing incoming traffic using the <a href=https://gateway-api.sigs.k8s.io/><strong>Gateway API</strong></a> (<code>GAPI</code>).</p><h2 id=-our-target>🎯 Our target</h2><ul><li>Understand exactly what the <strong>Gateway API</strong> is and how it represents an evolution from the <code>Ingress</code> API.</li><li>Demonstrations of real-world scenarios deployed the GitOps way.</li><li>Current limitations and upcoming developments.</li></ul><div class="notices tip"><div class=label>Tip</div><p>All the steps carried out in this article come from this <a href=https://github.com/Smana/cilium-gateway-api><strong>git repository</strong></a>.</p><p>I encourage you to explore it, as it goes far beyond the context of this article:</p><ul><li>Installation of an <strong>EKS</strong> cluster with <code>Cilium</code> configured with the kube-proxy replacement enbled and a dedicated Daemonset for <code>Envoy</code>.</li><li>Proposal of a <code>Flux</code> structure with dependency management and a DRY code I think is efficient.</li><li><code>Crossplane</code> and <a href=https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html>IRSA</a> composition which simplifies the management of IAM permissions for platform components.</li><li>Automated domain names and certificates management with <code>External-DNS</code> and <code>Let's Encrypt</code>.</li></ul><p>The idea being to have everything set up in just a few minutes, with a single command line 🤩.</p></div><h2 id=-introduction-to-gateway-api>☸ Introduction to Gateway API</h2><p>As mentioned previously, there are many <strong>Ingress Controllers</strong> options, and each has its own specificities and particular features, sometimes making their use complex. Furthermore, the traditionnal <code>Ingress</code> API in Kubernetes has very limited parameters. Some solutions have even created their own <a href=https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/>CRDs</a> (Kubernetes Custom Resources) while others use <code>annotations</code> to overcome these limitations.</p><p>Here comes the <strong>Gateway API</strong>! This is actually a <strong>standard</strong> that allows declaring advanced networking features without requiring specific extensions to the underlying controller. Moreover, since all controllers use the same API, it is possible to switch from one solution to another <strong>without changing the configuration</strong> (The Kubenetes manifests which describe how the incoming traffic should be routed).</p><p>Among the concepts that we will explore, GAPI brings a granular authorization model which defines <strong>explicit roles with distinct permissions</strong>. (More information on the GAPI security model <a href=https://gateway-api.sigs.k8s.io/concepts/security-model/#roles-and-personas>here</a>).</p><p>This is worth noting that this project is driven by the <a href=https://github.com/kubernetes/community/tree/master/sig-network>sig-network-kubernetes</a> working group, and there's a slack <a href=https://kubernetes.slack.com/archives/CR0H13KGA>channel</a> where you can reach out to them if needed.</p><p>Let's see how GAPI is used in practice with Cilium 🚀!</p><h2 id=ballot_box_with_check-prerequisites>&#9745;&#xfe0f; Prerequisites</h2><p>For the remainder of this article, we assume an EKS cluster has been deployed. If you're not using the <a href=https://github.com/Smana/cilium-gateway-api/tree/main/opentofu/eks>method suggested in the demo repo</a> as the basis for this article, there are a few <strong>points to check</strong> for GAPI to be usable.</p><p>ℹ️ The installation method described here is based on <code>Helm</code>, all the <code>values</code> can be viewed <a href=https://github.com/Smana/cilium-gateway-api/blob/main/opentofu/eks/helm_values/cilium.yaml>here</a>.</p><ul><li><p><strong>Install</strong> the <code>CRDs</code> available in the <a href=https://github.com/kubernetes-sigs/gateway-api/tree/main/config/crd>Gateway API</a> repository.<div class="notices note"><div class=label>Note</div><p>If Cilium is set up with <code>GAPI</code> support (see below) and the CRDs are missing, it won't start.
In the <a href=https://github.com/Smana/cilium-gateway-api>demo repo</a>, the <strong>GAPI CRDs</strong> are installed once during the cluster creation so that Cilium can start, and then they are managed by Flux.</p></div></p></li><li><p><strong>Replace</strong> <code>kube-proxy</code> with the network forwarding features provided by Cilium and <code>eBPF</code>.</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nt>kubeProxyReplacement</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><ul><li><strong>Enable</strong> Gateway API support.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nt>gatewayAPI</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><ul><li><p><strong>Check</strong> the installation
For that you need to install the command line tool <code>cilium</code>. I personnaly use <a href=https://blog.ogenki.io/post/asdf/asdf/>asdf</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>asdf plugin-add cilium-cli
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>asdf install cilium-cli 0.15.7
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go>asdf global cilium 0.15.7
</span></span></span></code></pre></div><p>The following command allows to ensure that all the components are up and running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln> 1</span><span class=cl><span class=go>cilium status --wait
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=go>   /¯¯\
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=go>/¯¯\__/¯¯\    Cilium:             OK
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=go>\__/¯¯\__/    Operator:           OK
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=go>/¯¯\__/¯¯\    Envoy DaemonSet:    OK
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=go>\__/¯¯\__/    Hubble Relay:       disabled
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=go>   \__/       ClusterMesh:        disabled
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=err></span><span class=go>Deployment             cilium-operator    Desired: 2, Ready: 2/2, Available: 2/2
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=go>DaemonSet              cilium             Desired: 2, Ready: 2/2, Available: 2/2
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=go>DaemonSet              cilium-envoy       Desired: 2, Ready: 2/2, Available: 2/2
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=go>Containers:            cilium             Running: 2
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=go>                      cilium-operator    Running: 2
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=go>                      cilium-envoy       Running: 2
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=go>Cluster Pods:          33/33 managed by Cilium
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=go>Helm chart version:    1.14.2
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=go>Image versions         cilium             quay.io/cilium/cilium:v1.14.2@sha256:6263f3a3d5d63b267b538298dbeb5ae87da3efacf09a2c620446c873ba807d35: 2
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=go>                      cilium-operator    quay.io/cilium/operator-aws:v1.14.2@sha256:8d514a9eaa06b7a704d1ccead8c7e663334975e6584a815efe2b8c15244493f1: 2
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=go>                      cilium-envoy       quay.io/cilium/cilium-envoy:v1.25.9-e198a2824d309024cb91fb6a984445e73033291d@sha256:52541e1726041b050c5d475b3c527ca4b8da487a0bbb0309f72247e8127af0ec: 2
</span></span></span></code></pre></div><p>Finally you can check that the Gateway API support is enabled by running</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>cilium config view | grep -w &#34;enable-gateway-api&#34;
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>enable-gateway-api                                true
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go>enable-gateway-api-secrets-sync                   true
</span></span></span></code></pre></div><p>You could also run end to end tests as follows</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>cilium connectivity test
</span></span></span></code></pre></div><p>⚠️ However this command (<code>connectivity test</code>) currently throws errors with Envoy as a DaemonSet enabled. (<a href=https://github.com/cilium/cilium/issues/28057>Github Issue</a>).</p><div class="notices info"><div class=label>Info</div><p><img src=https://raw.githubusercontent.com/cncf/artwork/master/projects/envoy/horizontal/color/envoy-horizontal-color.svg width=120 height=120 alt> <strong>as DaemonSet</strong></p><p>By default, the Cilium agent also runs <code>Envoy</code> within the same pod and delegates to it level 7 network operations.
Since the version <code>v1.14</code>, it is possible to deploy Envoy separately, which brings several benefits:</p><ul><li>If one modifies/restarts a component (whether it's Cilium or Envoy), it doesn't affect the other.</li><li>Better allocate resources to each component to optimize performance.</li><li>Limits the attack surface in case of compromise of one of the pods.</li><li>Envoy logs and Cilium agent logs are not mixed.</li></ul><p>You can use the following command to check that this feature is indeed active:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>cilium status
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>    /¯¯\
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go> /¯¯\__/¯¯\    Cilium:             OK
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=go> \__/¯¯\__/    Operator:           OK
</span></span></span><span class="line hl"><span class=ln>5</span><span class=cl><span class=go> /¯¯\__/¯¯\    Envoy DaemonSet:    OK
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=go> \__/¯¯\__/    Hubble Relay:       disabled
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=go>    \__/       ClusterMesh:        disabled
</span></span></span></code></pre></div><p><a href=https://isovalent.com/blog/post/cilium-release-114/#h-envoy-daemonset>More info</a>.</p></div></li></ul><h2 id=-the-entry-point-gatewayclass-and-gateway>🚪 The Entry Point: GatewayClass and Gateway</h2><center><img src=gateway.png alt=Gateway width=650></center><p>Once <a href=/post/cilium-gateway-api/#☑️-prerequisites>the conditions</a> are met, we have access to several elements. We can make use of the custom resources defined by the Gateway API CRDs. Moreover, right after installing Cilium, a <code>GatewayClass</code> is immediately available.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>kubectl get gatewayclasses.gateway.networking.k8s.io
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>NAME     CONTROLLER                     ACCEPTED   AGE
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go>cilium   io.cilium/gateway-controller   True       7m59s
</span></span></span></code></pre></div><p>On a Kubernetes cluster, you could configure multiple <code>GatewayClasses</code>, thus having the ability to use different implementations. For instance, we can use <code>Linkerd</code> by referencing the GatewayClass in the <code>Gateway</code> configuration.</p><p>The <code>Gateway</code> is the resource that allows <strong>triggering</strong> the creation of load balancing components in the Cloud provider.</p><p>Here's a simple example:
<a href=https://github.com/Smana/cilium-gateway-api/blob/main/apps/base/echo/gateway.yaml>apps/base/echo/gateway.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>gateway.networking.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Gateway</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-gateway</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>gatewayClassName</span><span class=p>:</span><span class=w> </span><span class=l>cilium</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span><span class=nt>listeners</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>HTTP</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-1-echo-server</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span><span class=nt>allowedRoutes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>        </span><span class=nt>namespaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>          </span><span class=nt>from</span><span class=p>:</span><span class=w> </span><span class=l>Same</span><span class=w>
</span></span></span></code></pre></div><p>On AWS (EKS), when configuring a <code>Gateway</code>, Cilium creates a <code>Service</code> of type <code>LoadBalancer</code>. Then another controller (The <a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller>AWS Load Balancer Controller</a>) handles the creation of the Cloud load balancer (<a href=https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html>NLB</a>)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>kubectl get svc -n echo cilium-gateway-echo
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>NAME                  TYPE           CLUSTER-IP     EXTERNAL-IP                                                                 PORT(S)        AGE
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go>cilium-gateway-echo   LoadBalancer   172.20.19.82   k8s-echo-ciliumga-64708ec85c-fcb7661f1ae4e4a4.elb.eu-west-3.amazonaws.com   80:30395/TCP   2m58s
</span></span></span></code></pre></div><p>This is worth noting that the load balancer address is also linked to the <code>Gateway</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>kubectl get gateway -n echo echo
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>NAME   CLASS    ADDRESS                                                                     PROGRAMMED   AGE
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go>echo   cilium   k8s-echo-ciliumga-64708ec85c-fcb7661f1ae4e4a4.elb.eu-west-3.amazonaws.com   True         16m
</span></span></span></code></pre></div><h2 id=arrow_right_hook-routing-rules-httproute>&#8618;&#xfe0f; Routing rules: HTTPRoute</h2><h3 id=a-basic-rule>A basic rule</h3><center><img src=simple-httproute.png alt=HTTPRoute width=950></center><p>To summarize the above diagram in a few words:</br>An <code>HTTPRoute</code> allows configuring the routing to the service by referencing the Gateway and defining the desired routing parameters.</p><div class="notices note"><div class=label>Note</div><p><img src=https://raw.githubusercontent.com/cncf/artwork/5281c91b356fccf31aa12fcb3374799774438b59/projects/kyverno/horizontal/color/kyverno-horizontal-color.png width=120 height=120 alt> <strong>workaround</strong></p><p>As of now, it is not possible to configure the annotations of services generated by the <code>Gateways</code> (<a href=https://github.com/cilium/cilium/issues/25357>Github Issue</a>). A workaround has been proposed to modify the service generated by the <code>Gateway</code> as soon as it is created.</p><p>Kyverno is a tool that ensures configuration compliance with best practices and security requirements. We are using it here solely for its ability to easily describe a <a href=https://kyverno.io/docs/writing-policies/mutate/>mutation</a> rule.</p><p><a href=https://github.com/Smana/cilium-gateway-api/blob/main/security/mycluster-0/echo-gw-clusterpolicy.yaml>security/mycluster-0/echo-gw-clusterpolicy.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mutate-svc-annotations</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>      </span><span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>        </span><span class=nt>any</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>          </span>- <span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>              </span><span class=nt>kinds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>                </span>- <span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>              </span><span class=nt>namespaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>                </span>- <span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cilium-gateway-echo</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span><span class=nt>mutate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>        </span><span class=nt>patchStrategicMerge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>          </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>            </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>              </span><span class=nt>external-dns.alpha.kubernetes.io/hostname</span><span class=p>:</span><span class=w> </span><span class=l>echo.${domain_name}</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>              </span><span class=nt>service.beta.kubernetes.io/aws-load-balancer-scheme</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;internet-facing&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>              </span><span class=nt>service.beta.kubernetes.io/aws-load-balancer-backend-protocol</span><span class=p>:</span><span class=w> </span><span class=l>tcp</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>          </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>            </span><span class=nt>loadBalancerClass</span><span class=p>:</span><span class=w> </span><span class=l>service.k8s.aws/nlb</span><span class=w>
</span></span></span></code></pre></div><p>The service <code>cilium-gateway-echo</code> will therefore have the AWS controller's annotations added, as well as an annotation allowing for automatic DNS record configuration.</p></div><p><a href=https://github.com/Smana/cilium-gateway-api/blob/main/apps/base/echo/httproute.yaml>apps/base/echo/httproute.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>gateway.networking.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HTTPRoute</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-1</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>parentRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln> 8</span><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class="line hl"><span class=ln> 9</span><span class=cl><span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>10</span><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span>- <span class=nt>matches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>        </span>- <span class=nt>path</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>PathPrefix</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>            </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>/</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>      </span><span class=nt>backendRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-1-echo-server</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>          </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></div><p>The example used above is very simple: all requests are forwarded to the <code>echo-1-echo-server</code> service.<br><code>parentRefs</code> indicates which <code>Gateway</code> to use and then the routing rules are defined under the <code>rules</code> section.</p><p>The routing rules could also be based on the <code>path</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>  </span><span class=nt>hostnames</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>  </span>- <span class=l>foo.bar.com</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w>  </span>- <span class=nt>matches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w>    </span>- <span class=nt>path</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>PathPrefix</span><span class=w>
</span></span></span><span class=line><span class=ln>9</span><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>/login</span><span class=w>
</span></span></span></code></pre></div><p>Or based on an HTTP Header</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>  </span>- <span class=nt>matches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w>      </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;version&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span></code></pre></div><p>Let's check if the service is reachable.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>curl -s http://echo.cloud.ogenki.io | jq -rc &#39;.environment.HOSTNAME&#39;
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>echo-1-echo-server-fd88497d-w6sgn
</span></span></span></code></pre></div><p>As you can see, the service is exposed in HTTP without a certificate. Let's try to fix that 😉</p><h3 id=configure-a-tls-certificate>Configure a TLS certificate</h3><p>There are several methods to configure TLS with GAPI. Here, we will use the most common case: HTTPS protocol and TLS termination at the Gateway.</p><p>Let's assume we want to configure the domain name <code>echo.cloud.ogenki.io</code> used earlier. The configuration is mainly done by configuring the <code>Gateway</code>.</p><p><a href=https://github.com/Smana/cilium-gateway-api/blob/main/apps/base/echo/tls-gateway.yaml>apps/base/echo/tls-gateway.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>gateway.networking.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Gateway</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=nt>cert-manager.io/cluster-issuer</span><span class=p>:</span><span class=w> </span><span class=l>letsencrypt-prod</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>  </span><span class=nt>gatewayClassName</span><span class=p>:</span><span class=w> </span><span class=l>cilium</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>  </span><span class=nt>listeners</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>12</span><span class=cl><span class=w>      </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;echo.${domain_name}&#34;</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>13</span><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>443</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>14</span><span class=cl><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>HTTPS</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>      </span><span class=nt>allowedRoutes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>        </span><span class=nt>namespaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>          </span><span class=nt>from</span><span class=p>:</span><span class=w> </span><span class=l>Same</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>18</span><span class=cl><span class=w>      </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>19</span><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>Terminate</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>20</span><span class=cl><span class=w>        </span><span class=nt>certificateRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>21</span><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-tls</span><span class=w>
</span></span></span></code></pre></div><p>The essential point here is the reference to a secret containing the certificate named <code>echo-tls</code>. This certificate can be created manually, but for this article, I chose to automate this with <strong>Let's Encrypt</strong> and <code>cert-manager</code>.</p><div class="notices info"><div class=label>Info</div><p><img src=https://raw.githubusercontent.com/cncf/artwork/2182b6b6a19cc9e720679f4d1ec756dad73426eb/projects/cert-manager/icon/color/cert-manager-icon-color.png width=70 height=70 alt> <strong>cert-manager</strong></p><p>With <code>cert-manager</code>, it's pretty straightforward to automate the creation and update of certificates exposed by the <code>Gateway</code>. For this, you need to allow the controller to access <a href=https://aws.amazon.com/route53/>route53</a> in order to solve a DNS01 challenge (A mechanism that ensures that clients can only request certificates for domains they own).</p><p>A <a href=https://github.com/Smana/cilium-gateway-api/blob/main/security/base/cert-manager/cluster-issuer-staging.yaml>ClusterIssuer</a> resource describes the required configuration to generate certificates with cert-manager.</p><p>Next, we just need to add an annotation <code>cert-manager.io/cluster-issuer</code> and set the Kubernetes secret where the certificate will be stored.</p><p><a href=https://cert-manager.io/docs/usage/gateway/>More information</a></p><p>ℹ️ In the demo repo, permissions are assigned using <code>Crossplane</code>, which takes care of configuring these IAM perms in AWS.</p></div><p>For routing to work correctly, you also need to attach the <code>HTTPRoute</code> to the right Gateway and specify the domain name.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>gateway.networking.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HTTPRoute</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-1</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>parentRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln> 8</span><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class="line hl"><span class=ln> 9</span><span class=cl><span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>10</span><span class=cl><span class=w>  </span><span class=nt>hostnames</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>11</span><span class=cl><span class=w>    </span>- <span class=s2>&#34;echo.${domain_name}&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span></code></pre></div><p>After a few seconds the certificate will be created.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>kubectl get cert -n echo
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>NAME       READY   SECRET     AGE
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go>echo-tls   True    echo-tls   43m
</span></span></span></code></pre></div><p>Finally, we can check that the certificate indeed comes from Let's Encrypt as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>curl https://echo.cloud.ogenki.io -v 2&gt;&amp;1 | grep -A 6 &#39;Server certificate&#39;
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>* Server certificate:
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go>*  subject: CN=echo.cloud.ogenki.io
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=go>*  start date: Sep 15 14:43:00 2023 GMT
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=go>*  expire date: Dec 14 14:42:59 2023 GMT
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=go>*  subjectAltName: host &#34;echo.cloud.ogenki.io&#34; matched cert&#39;s &#34;echo.cloud.ogenki.io&#34;
</span></span></span><span class="line hl"><span class=ln>7</span><span class=cl><span class=go>*  issuer: C=US; O=Let&#39;s Encrypt; CN=R3
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=go>*  SSL certificate verify ok.
</span></span></span></code></pre></div><div class="notices info"><div class=label>Info</div><p>GAPI also allows you to configure <strong>end-to-end TLS</strong>, all the way to the container.
This is done by configuring the Gateway in <code>Passthrough</code> mode and using a <code>TLSRoute</code> resource.
The certificate must also be carried by the pod that performs the TLS termination.</p></div><h3 id=sharing-a-gateway-accross-multiple-namespaces>Sharing a Gateway accross multiple namespaces</h3><center><img src=shared-gateway.png alt="Shared Gateway" width=850></center><p>With <code>GAPI</code>, you can route traffic across <code>Namespaces</code>. This is made possible thanks to distinct resources for each function: A <code>Gateway</code> that allows configuring the infrastructure, and the <code>*Routes</code>. These routes can be attached to a Gateway located in another namespace. It is thus possible for different teams/projects to share the same infrastructure components.</p><p>However, this requires to specify which route is allowed to reference the Gateway. Here we assume that we have a Gateway dedicated to internal tools called <code>platform</code>.
By using the <code>allowedRoutes</code> parameter, we explicitly specify which namespaces are allowed to be attached to this Gateway.</p><p><a href=https://github.com/Smana/cilium-gateway-api/blob/main/infrastructure/base/gapi/platform-gateway.yaml>infrastructure/base/gapi/platform-gateway.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>      </span><span class=nt>allowedRoutes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>        </span><span class=nt>namespaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>          </span><span class=nt>from</span><span class=p>:</span><span class=w> </span><span class=l>Selector</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>          </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>            </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>              </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes.io/metadata.name</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>                </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>                </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>                  </span>- <span class=l>observability</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>                  </span>- <span class=l>flux-system</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>Terminate</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>        </span><span class=nt>certificateRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>platform-tls</span><span class=w>
</span></span></span></code></pre></div><p>The <code>HTTPRoutes</code> configured in the namespaces <code>observability</code> and <code>flux-system</code> are attached to this unique <code>Gateway</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>  </span><span class=nt>parentRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>platform</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>infrastructure</span><span class=w>
</span></span></span></code></pre></div><p>And therefore, use the same load balancer from the Cloud provider.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln> 1</span><span class=cl><span class=go>NLB_DOMAIN=$(kubectl get svc -n infrastructure cilium-gateway-platform -o jsonpath={.status.loadBalancer.ingress[0].hostname})
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=err></span><span class=go>dig +short ${NLB_DOMAIN}
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=go>13.36.89.108
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=err></span><span class=go>dig +short grafana-mycluster-0.cloud.ogenki.io
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=go>13.36.89.108
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=err></span><span class=go>dig +short gitops-mycluster-0.cloud.ogenki.io
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=go>13.36.89.108
</span></span></span></code></pre></div><div class="notices note"><div class=label>Note</div><p>🔒 These internal tools shouldn't be exposed on the Internet, but you know: this is just a demo 🙏.
For instance, we could use an internal Gateway (private IP) by playing with the annotations and make use of a private connection system (VPN, tunnels...).</p></div><h3 id=traffic-splitting>Traffic splitting</h3><center><img src=split.png alt=Split width=750></center><p>One feature that is commonly brought by Service Meshes is the ability to test an application on a portion of the traffic when a new version is available (A/B testing or Canary deployment).
<code>GAPI</code> makes this quite simple by using weights.</p><p>Here's an example that forwards 5% of the traffic to the service <code>echo-2-echo-server</code>:</p><p><a href=https://github.com/Smana/cilium-gateway-api/blob/main/apps/base/echo/httproute-split.yaml>apps/base/echo/httproute-split.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>  </span><span class=nt>hostnames</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>    </span>- <span class=s2>&#34;split-echo.${domain_name}&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>    </span>- <span class=nt>matches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>        </span>- <span class=nt>path</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>PathPrefix</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>            </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>/</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>      </span><span class=nt>backendRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-1-echo-server</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>          </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>          </span><span class=nt>weight</span><span class=p>:</span><span class=w> </span><span class=m>95</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-2-echo-server</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>          </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>          </span><span class=nt>weight</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span></code></pre></div><p>Let's check that the distribution happens as expected:</p><p><a href=https://github.com/Smana/cilium-gateway-api/blob/main/scripts/check-split.sh>scripts/check-split.sh</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>./scripts/check-split.sh https://split-echo.cloud.ogenki.io
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>Number of requests for echo-1: 95
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go>Number of requests for echo-2: 5
</span></span></span></code></pre></div><h3 id=headers-modifications>Headers modifications</h3><p>It is also possible to change HTTP <strong>Headers</strong>: to add, modify, or delete them. These modifications can be applied to either request or response headers through the use of <a href=https://gateway-api.sigs.k8s.io/api-types/httproute#filters-optional>filters</a> in the <code>HTTPRoute</code> manifest.</p><p>For instance, we will add a Header to the <strong>request</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>gateway.networking.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HTTPRoute</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-1</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span>- <span class=nt>matches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>        </span>- <span class=nt>path</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>PathPrefix</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>            </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>/req-header-add</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>      </span><span class=nt>filters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>        </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>RequestHeaderModifier</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>          </span><span class=nt>requestHeaderModifier</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>            </span><span class=nt>add</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>              </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>foo</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>                </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>bar</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>      </span><span class=nt>backendRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-1-echo-server</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>          </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span></code></pre></div><p>This command allows to that the header is indeed added:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln> 1</span><span class=cl><span class=go>curl -s https://echo.cloud.ogenki.io/req-header-add | jq &#39;.request.headers&#39;
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=go>{
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=go>  &#34;host&#34;: &#34;echo.cloud.ogenki.io&#34;,
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=go>  &#34;user-agent&#34;: &#34;curl/8.2.1&#34;,
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=go>  &#34;accept&#34;: &#34;*/*&#34;,
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=go>  &#34;x-forwarded-for&#34;: &#34;81.220.234.254&#34;,
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=go>  &#34;x-forwarded-proto&#34;: &#34;https&#34;,
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=go>  &#34;x-envoy-external-address&#34;: &#34;81.220.234.254&#34;,
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=go>  &#34;x-request-id&#34;: &#34;320ba4d2-3bd6-4c2f-8a97-74296a9f3f26&#34;,
</span></span></span><span class="line hl"><span class=ln>10</span><span class=cl><span class=go>  &#34;foo&#34;: &#34;bar&#34;
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=go>}
</span></span></span></code></pre></div><h2 id=-assign-the-proper-permissions>🔒 Assign the proper permissions</h2><p><code>GAPI</code> offers a clear permission-sharing model between the traffic routing infrastructure (managed by cluster administrators) and the applications (managed by developers).</p><p>The availability of multiple custom resources allows to use Kubernete's <strong>RBAC</strong> configuration to assign permissions in a declarative way.
I've added <a href=https://github.com/Smana/cilium-gateway-api/tree/main/security/base/rbac>a few examples</a> which have no effect in my demo cluster but might give you an idea.</p><p>The configuration below grants members of the <code>developers</code> group the ability to manage <code>HTTPRoutes</code> within the echo namespace, while only providing them read access to the <code>Gateways</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Role</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gapi-developer</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;gateway.networking.k8s.io&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;httproutes&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;*&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;gateway.networking.k8s.io&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;gateways&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>RoleBinding</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gapi-developer</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>  </span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Group</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;developers&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w>    </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Role</span><span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gapi-developer</span><span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span></code></pre></div><h2 id=-a-somewhat-unclear-scope-at-first-glance>🤔 A somewhat unclear scope at first glance</h2><p>One could be confused with what's commonly referred to as an <code>API Gateway</code>. A section of the <a href=https://gateway-api.sigs.k8s.io/faq/>FAQ</a> has been created to clarify its difference with the <code>Gateway API</code>. Although GAPI offers features typically found in an API Gateway, it primarily serves as a specific implementation for Kubernetes. However, the choice of this name can indeed cause <strong>confusion</strong>.</p><p>Moreover please note that this article focuses solely on inbound traffic, termed <a href=https://gateway-api.sigs.k8s.io/concepts/glossary/#northsouth-traffic>north-south</a>, traditionally managed by <em>Ingress Controllers</em>. This traffic is actually GAPI's initial scope. A recent initiative named <a href=https://gateway-api.sigs.k8s.io/concepts/gamma/><strong>GAMMA</strong></a> aims to also handle <a href=https://gateway-api.sigs.k8s.io/concepts/glossary/#eastwest-traffic>east-west</a> routing, which will standardize certain features commonly provided by <code>Service Meshes</code> solutions in the future. (See <a href=https://kubernetes.io/blog/2023/08/29/gateway-api-v0-8/>this article</a> for more details).</p><h2 id=-final-thoughts>💭 Final thoughts</h2><p>To be honest, I've known about the <strong>Gateway API</strong> for some time. Although I've read a few articles, I hadn't truly dived deep. I'd think, "Why bother? My <em>Ingress Controller</em> works, and there's a learning curve with this."</p><p>GAPI is on the rise and nearing its GA release. Several <a href=https://gateway-api.sigs.k8s.io/implementations/>projects</a> have embraced it, and this API for managing traffic within Kubernetes will quickly become the standard.</p><p>I must say, configuring GAPI felt intuitive and explicit ❤️. Its security model strikes a balance, empowering developers without compromising security. And the seamless infrastructure management? You can switch between implementations without touching the <code>*Routes</code>.</p><p>Would I swap my Ingress Controller for <code>Cilium</code> today? <strong>Not yet, but it's on the horizon</strong>.</p><p>It's worth highlighting Cilium's broad range of capabilities: With Kubernetes surrounded by a plethora of tools, Cilium stands out, promising features like metrics, tracing, service-mesh, security, and, yes, <em>Ingress Controller</em> with GAPI.</p><p>However, there are a few challenges to note:</p><ul><li><a href=https://github.com/cilium/cilium/issues/21929>TCP and UDP support</a></li><li><a href=https://github.com/cilium/cilium/issues/21928>GRPC support</a></li><li>The need to use a mutation rule to configure cloud components (<a href=https://github.com/cilium/cilium/issues/25357>Github Issue</a>).</li><li>Many of the features discussed in this blog are still in the experimental stage. For instance, the <a href=https://github.com/cilium/cilium/pull/27472>extended functions</a>, which have been supported since the most recent release at the time of my writing (<code>v1.14.2</code>). I attempted to set up a straightforward HTTP>HTTPS redirect but ran into <a href=https://github.com/kubernetes-sigs/gateway-api/issues/1185>this issue</a>. Consequently, I expect some modifications to the API in the near future.</li></ul><p>While I've only scratched the surface of what Cilium's GAPI can offer (honestly, this post is already quite long 😜), I am hopeful that we can consider its use in production soon. But considering the points mentioned earlier, I would advise waiting a bit longer. That said if you want to prepare the future, now's the time 😉!</p><h2 id=-references>🔖 References</h2><ul><li><a href=https://gateway-api.sigs.k8s.io/>https://gateway-api.sigs.k8s.io/</a></li><li><a href=https://docs.cilium.io/en/latest/network/servicemesh/gateway-api/gateway-api/#gs-gateway-api>https://docs.cilium.io/en/latest/network/servicemesh/gateway-api/gateway-api/#gs-gateway-api</a></li><li><a href=https://isovalent.com/blog/post/cilium-gateway-api/>https://isovalent.com/blog/post/cilium-gateway-api/</a></li><li><a href=https://isovalent.com/blog/post/tutorial-getting-started-with-the-cilium-gateway-api/>https://isovalent.com/blog/post/tutorial-getting-started-with-the-cilium-gateway-api/</a></li><li>Isovalent's <a href=https://isovalent.com/resource-library/labs/>labs</a> are great to start playing with Gateway API and you'll get new badges to add to your collection 😄 <img src=badges.png width=330 height=330 alt></li></ul></div><div class=post_comments></div><div class=post_i18n><h3 class=mb-0>Translations:</h3><nav class=tags_nav><a href=https://blog.ogenki.io/fr/post/cilium-gateway-api/ class="post_tag button button_translucent">Français</a></nav></div></article><aside class=sidebar><section class=sidebar_inner><br><div class=search><input type=search class="search_field form_field" placeholder=Search... id=find autocomplete=off data-scope=post>
<label for=find class=search_label><svg class="icon"><title>search</title><use xlink:href="#search"/></svg></label><div class="search_results results"></div></div><div class=author_header><img src=https://blog.ogenki.io/images/smana.jpg alt="Smaine Kahlouch photo"><h2>Smaine Kahlouch</h2></div><div class=author_bio>Lead SRE/DevOps, Team leader, Open Source enthusiast.</div><a href=https://blog.ogenki.io/about/ class="button mt-1" role=button title='Read More'>Read More</a><h2 class=mt-4>Featured Posts</h2><ul><li><a href=https://blog.ogenki.io/post/series/observability/alerts/ class=nav-link title="`VictoriaMetrics` : Effective alerts, from theory to practice 🛠️"><code>VictoriaMetrics</code> : Effective alerts, from theory to practice 🛠️</a></li><li><a href=https://blog.ogenki.io/post/series/observability/metrics/ class=nav-link title="Harness the Power of `VictoriaMetrics` and `Grafana` Operators for Metrics Management">Harness the Power of <code>VictoriaMetrics</code> and <code>Grafana</code> Operators for Metrics Management</a></li><li><a href=https://blog.ogenki.io/post/dagger-intro/ class=nav-link title="`Dagger`: The missing piece of the developer experience?"><code>Dagger</code>: The missing piece of the developer experience?</a></li><li><a href=https://blog.ogenki.io/post/pki-gapi/ class=nav-link title="`TLS` with Gateway API: Efficient and Secure Management of Public and Private Certificates"><code>TLS</code> with Gateway API: Efficient and Secure Management of Public and Private Certificates</a></li><li><a href=https://blog.ogenki.io/post/crossplane_composition_functions/ class=nav-link title="Going Further with `Crossplane`: Compositions and Functions">Going Further with <code>Crossplane</code>: Compositions and Functions</a></li></ul><h2 class=mt-4>Recent Posts</h2><ul class=flex-column><li><a href=https://blog.ogenki.io/post/tailscale/ class=nav-link title="Beyond Traditional VPNs: Simplifying Cloud Access with `Tailscale`">Beyond Traditional VPNs: Simplifying Cloud Access with <code>Tailscale</code></a></li><li><a href=https://blog.ogenki.io/post/cilium-gateway-api/ class=nav-link title="`Gateway API`: Can I replace my Ingress Controller with `Cilium`?"><code>Gateway API</code>: Can I replace my Ingress Controller with <code>Cilium</code>?</a></li><li><a href=https://blog.ogenki.io/post/terraform-controller/ class=nav-link title="Applying GitOps Principles to Infrastructure: An overview of `tf-controller`">Applying GitOps Principles to Infrastructure: An overview of <code>tf-controller</code></a></li><li><a href=https://blog.ogenki.io/post/cnpg/ class=nav-link title="`CloudNativePG`: An easy way to run PostgreSQL on Kubernetes"><code>CloudNativePG</code>: An easy way to run PostgreSQL on Kubernetes</a></li><li><a href=https://blog.ogenki.io/post/devflux/ class=nav-link title="100% `GitOps` using Flux">100% <code>GitOps</code> using Flux</a></li><li><a href=https://blog.ogenki.io/post/crossplane_k3d/ class=nav-link title="My Kubernetes cluster (GKE) with `Crossplane`">My Kubernetes cluster (GKE) with <code>Crossplane</code></a></li><li><a href=https://blog.ogenki.io/post/asdf/asdf/ class=nav-link title="Manage tools versions with `asdf`">Manage tools versions with <code>asdf</code></a></li><li><a href=https://blog.ogenki.io/post/series/workshop_helm/templating/ class=nav-link title="Helm workshop: Templating exercises">Helm workshop: Templating exercises</a></li></ul><div><h2 class="mt-4 taxonomy" id=categories-section>Categories</h2><nav class=tags_nav><a href=https://blog.ogenki.io/categories/containers/ class="post_tag button button_translucent" title=containers>CONTAINERS
<span class=button_tally>7</span>
</a><a href=https://blog.ogenki.io/categories/devxp/ class="post_tag button button_translucent" title=devxp>DEVXP
<span class=button_tally>6</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=series-section>Series</h2><nav class=tags_nav><a href=https://blog.ogenki.io/series/workshop-kubernetes/ class="post_tag button button_translucent" title="workshop kubernetes">WORKSHOP KUBERNETES
<span class=button_tally>7</span>
</a><a href=https://blog.ogenki.io/series/workshop-helm/ class="post_tag button button_translucent" title="workshop helm">WORKSHOP HELM
<span class=button_tally>6</span>
</a><a href=https://blog.ogenki.io/series/observability/ class="post_tag button button_translucent" title=observability>OBSERVABILITY
<span class=button_tally>2</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=tags-section>Tags</h2><nav class=tags_nav><a href=https://blog.ogenki.io/tags/kubernetes/ class="post_tag button button_translucent" title=kubernetes>KUBERNETES
<span class=button_tally>15</span>
</a><a href=https://blog.ogenki.io/tags/helm/ class="post_tag button button_translucent" title=helm>HELM
<span class=button_tally>6</span>
</a><a href=https://blog.ogenki.io/tags/infrastructure/ class="post_tag button button_translucent" title=infrastructure>INFRASTRUCTURE
<span class=button_tally>4</span>
</a><a href=https://blog.ogenki.io/tags/devxp/ class="post_tag button button_translucent" title=devxp>DEVXP
<span class=button_tally>3</span>
</a><a href=https://blog.ogenki.io/tags/gitops/ class="post_tag button button_translucent" title=gitops>GITOPS
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/network/ class="post_tag button button_translucent" title=network>NETWORK
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/observability/ class="post_tag button button_translucent" title=observability>OBSERVABILITY
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/security/ class="post_tag button button_translucent" title=security>SECURITY
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/data/ class="post_tag button button_translucent" title=data>DATA
<span class=button_tally>1</span>
</a><a href=https://blog.ogenki.io/tags/index/ class="post_tag button button_translucent" title=index>INDEX
<span class=button_tally>1</span>
</a><a href=https://blog.ogenki.io/tags/local/ class="post_tag button button_translucent" title=local>LOCAL
<span class=button_tally>1</span>
</a><a href=https://blog.ogenki.io/tags/tooling/ class="post_tag button button_translucent" title=tooling>TOOLING
<span class=button_tally>1</span></a></nav></div></section></aside></div></main><svg width="0" height="0" class="hidden"><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter"><path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68.0 01-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043.0-1.924.366-2.643 1.078A3.56 3.56.0 008.766 5.383c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846.0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47.0.929.273 1.705.82 2.388a3.623 3.623.0 002.115 1.291c-.312.08-.641.118-.979.118-.312.0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652.0 002.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422.0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139.0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77.0 001.172-4.892v-.468a7.788 7.788.0 001.84-1.921 8.142 8.142.0 01-2.11.593z"/></symbol><symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar"><path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916.0 1e2v352c0 33.084 26.916 60 60 60h392c33.084.0 60-26.916 60-60V1e2c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028.0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028.0 20 8.972 20 20v48z"/><path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github"><path d="M255.968 5.329C114.624 5.329.0 120.401.0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384.0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008.0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992.0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584.0 34.368-.32 62.08-.32 70.496.0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab"><path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6.0L12.3 74.8z"/><path d="M12.3 74.7.5 111c-1 3.2.0 6.8 3 8.8l101.6 74-92.5-119z"/><path d="M105 193.7l-38.6-119h-54l92.7 119z"/><path d="M105 193.7l38.7-119H66.4l38.7 119z"/><path d="M105 193.7l38.7-119H198l-93 119z"/><path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/><path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6.0L198 74.8z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss"><circle cx="3.429" cy="20.571" r="3.429"/><path d="M11.429 24h4.57C15.999 15.179 8.821 8.001.0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"/><path d="M24 24C24 10.766 13.234.0.0.0v4.571c10.714.0 19.43 8.714 19.43 19.429z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h362c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top"><path d="M604.501 440.509 325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298.0 36.323s26.223 10.024 36.222.0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221.0 9.999-10.023 9.999-26.298.0-36.323z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly"><path d="M504.971 239.029 448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c19.851.0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002.0 004e2 320v108c0 19.851-16.149 36-36 36h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c46.318.0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568.0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255.0 24-10.745 24-24S205.255.0 192 0h-44c-46.318.0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568.0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255.0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851.0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002.0 00112 192z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy"><path d="M23 2.75A2.75 2.75.0 0020.25.0H8.75A2.75 2.75.0 006 2.75v13.5A2.75 2.75.0 008.75 19h11.5A2.75 2.75.0 0023 16.25zM18.25 14.5h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5z"/><path d="M8.75 20.5A4.255 4.255.0 014.5 16.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752.0 001 5.25v16A2.752 2.752.0 003.75 24h12a2.752 2.752.0 002.75-2.75v-.75z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme"><path d="M284.286 256.002 506.143 34.144c7.811-7.811 7.811-20.475.0-28.285-7.811-7.81-20.475-7.811-28.285.0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285.0-7.81 7.811-7.811 20.475.0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475.0 28.285a19.938 19.938.0 0014.143 5.857 19.94 19.94.0 0014.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475.0-28.285L284.286 256.002z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu"><path d="M492 236H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954.0 96s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram"><path d="M12 2.163c3.204.0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849.0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204.0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849.0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741.0 8.333.014 7.053.072c-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.668.072 4.948c.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24s3.668-.014 4.948-.072c4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403.0-6.162 2.759-6.162 6.162S8.597 18.163 12 18.163s6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zM12 16c-2.209.0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796.0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795.0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="youtube"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow"><path d="M21 27v-8h3v11H0V19h3v8h18z"/><path d="M17.1.2 15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8 13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord"><path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527.41542 45.5603.39851 45.468.440769 45.4204.525289 44.7963 1.6353 44.105 3.0834 43.6209 4.2216c-5.4572-.817-10.8864-.817-16.2317.0C26.905 3.0581 26.1886 1.6353 25.5617.525289 25.5141.443589 25.4218.40133 25.3294.41542c-5.071.87338-9.9237 2.40318-14.4518 4.48238C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795 1.57795 18.7309-.943561 32.1443.293408 45.3914.299005 45.4562.335386 45.5182.385761 45.5576 6.45866 50.0174 12.3413 52.7249 18.1147 54.5195 18.2071 54.5477 18.305 54.5139 18.3638 54.4378 19.7295 52.5728 20.9469 50.6063 21.9907 48.5383 22.0523 48.4172 21.9935 48.2735 21.8676 48.2256 19.9366 47.4931 18.0979 46.6 16.3292 45.5858 16.1893 45.5041 16.1781 45.304 16.3068 45.2082 16.679 44.9293 17.0513 44.6391 17.4067 44.3461 17.471 44.2926 17.5606 44.2813 17.6362 44.3151c11.6196 5.3051 24.1992 5.3051 35.6817.0C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433 53.9057 44.6363 54.2779 44.9293 54.6529 45.2082 54.7816 45.304 54.7732 45.5041 54.6333 45.5858c-1.7687 1.0339-3.6074 1.9073-5.5412 2.637C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383c1.0662 2.0651 2.2836 4.0316 3.6241 5.8967C52.6519 54.5139 52.7526 54.5477 52.845 54.5195c5.8014-1.7946 11.684-4.5021 17.7569-8.9619C70.6551 45.5182 70.6887 45.459 70.6943 45.3942 72.1747 30.0791 68.2147 16.7757 60.1968 4.9823 60.1772 4.9429 60.1437 4.9147 60.1045 4.8978zM23.7259 37.3253c-3.4983.0-6.3808-3.2117-6.3808-7.156s2.8266-7.156 6.3808-7.156c3.5821.0 6.4367 3.2399 6.3807 7.156.0 3.9443-2.8266 7.156-6.3807 7.156zm23.5919.0c-3.4982.0-6.3807-3.2117-6.3807-7.156s2.8265-7.156 6.3807-7.156c3.5822.0 6.4367 3.2399 6.3808 7.156.0 3.9443-2.7986 7.156-6.3808 7.156z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 18" id="mastodon"><path fill="#fff" d="m15.054695 9.8859583c-.22611 1.1632697-2.02517 2.4363497-4.09138 2.6830797-1.0774504.12856-2.1382704.24673-3.2694704.19484-1.84996-.0848-3.30971-.44157-3.30971-.44157.0.1801.0111.35157.0333.51194.24051 1.82571 1.81034 1.93508 3.29737 1.98607 1.50088.0514 2.8373104-.37004 2.8373104-.37004l.0617 1.35686s-1.0498104.56374-2.9199404.66742c-1.03124.0567-2.3117-.0259-3.80308-.42069-3.23454998-.85613-3.79081998-4.304-3.87592998-7.8024197-.026-1.03871-.01-2.01815-.01-2.83732.0-3.57732 2.34385998-4.62587996 2.34385998-4.62587996 1.18184-.54277 3.20976-.77101 5.318-.7882499985409h.0518C9.8267646.01719834 11.856025.24547834 13.037775.78824834c0 0 2.34377 1.04855996 2.34377 4.62587996.0.0.0294 2.63937-.32687 4.47183"/><path fill="#000" d="m12.616925 5.6916583v4.3315297h-1.71607V5.8189683c0-.88624-.37289-1.33607-1.1187604-1.33607-.82467.0-1.23799.53361-1.23799 1.58875v2.30122h-1.70594v-2.30122c0-1.05514-.4134-1.58875-1.23808-1.58875-.74587.0-1.11876.44983-1.11876 1.33607v4.2042197h-1.71607V5.6916583c0-.88527.22541-1.58876.67817-2.10922.46689-.52047 1.07833-.78727 1.83735-.78727.87816.0 1.54317.33752 1.98288 1.01267l.42744.71655.42753-.71655c.43961-.67515 1.10463-1.01267 1.9828704-1.01267.75893.0 1.37037.2668 1.83735.78727.45268.52046.67808 1.22395.67808 2.10922"/></symbol></svg><footer class=footer><div class="footer_inner wrap pale"><img src=https://blog.ogenki.io/icons/footer.png class="icon icon_2 transparent" alt="Copyright © 2021–2023, Smana https://github.io/Smana"><p>Copyright&nbsp;<span class=year></span>&nbsp;COPYRIGHT © 2021–2023, SMANA HTTPS://GITHUB.IO/SMANA. All Rights Reserved</p><a class=to_top href=#documentTop><svg class="icon"><title>to-top</title><use xlink:href="#to-top"/></svg></a></div></footer><script type=text/javascript src=https://blog.ogenki.io/en/js/bundle.fb0be5bcaafc43d845951fd0966e48e5a7bf36be99ce2176c89d369bb5a8136dfb14e596d145cfa04c4c3b79232ffffd811a01eccee956d9d61cf49330e633c7.js integrity="sha512-+wvlvKr8Q9hFlR/Qlm5I5ae/Nr6ZziF2yJ02m7WoE237FOWW0UXPoExMO3kjL//9gRoB7M7pVtnWHPSTMOYzxw==" crossorigin=anonymous></script><script src=https://blog.ogenki.io/js/search.min.73cb82d8f274395dd220d6594053cd3d3d8ac8c97d874b5142a60b9744f3704d765551e0ade104d5803c66b731f5a7a00ac2cff33c8c9090ff8100169a3e2574.js></script></body></html>