<!doctype html><html lang=en data-figures class=page><head><title>`TLS` with Gateway API: Efficient and Secure Management of Public and Private Certificates | Ogenki</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=XXXXXXXXXX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","XXXXXXXXXX")</script><meta property="og:locale" content="en"><meta property="og:locale:alternate" content="fr"><meta property="og:type" content="article"><meta name=description content="Building a robust PKI strategy for managing public and private TLS certificates using Cert-Manager, Vault, and Let's Encrypt."><meta name=twitter:card content="summary"><meta name=twitter:creator content="@smana.dev"><meta name=twitter:title content="`TLS` with Gateway API: Efficient and Secure Management of Public and Private Certificates"><meta name=twitter:image content="https://blog.ogenki.io/post/pki-gapi/thumbnail.png"><meta property="og:url" content="https://blog.ogenki.io/post/pki-gapi/"><meta property="og:title" content="`TLS` with Gateway API: Efficient and Secure Management of Public and Private Certificates"><meta property="og:description" content="Building a robust PKI strategy for managing public and private TLS certificates using Cert-Manager, Vault, and Let's Encrypt."><meta property="og:image" content="https://blog.ogenki.io/post/pki-gapi/thumbnail.png"><meta name=keywords content="security"><link rel=apple-touch-icon sizes=180x180 href=https://blog.ogenki.io/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.ogenki.io/icons/favicon-32x32.png><link rel=manifest href=https://blog.ogenki.io/icons/site.webmanifest><link rel=canonical href=https://blog.ogenki.io/post/pki-gapi/><link rel=preload href=https://blog.ogenki.io/css/styles.a556cef0edd8ecd9821e661f7f201d84cc18d0c6435703889db2949aea0eccb84b7ac9a2bb49093b03f5e7d9ce21c23c705efd6dcbd7e8018afae9a9f32ca095.css integrity="sha512-pVbO8O3Y7NmCHmYffyAdhMwY0MZDVwOInbKUmuoOzLhLesmiu0kJOwP159nOIcI8cF79bcvX6AGK+ump8yyglQ==" as=style crossorigin=anonymous><link rel=preload href=https://blog.ogenki.io/en/js/bundle.fb0be5bcaafc43d845951fd0966e48e5a7bf36be99ce2176c89d369bb5a8136dfb14e596d145cfa04c4c3b79232ffffd811a01eccee956d9d61cf49330e633c7.js as=script integrity="sha512-+wvlvKr8Q9hFlR/Qlm5I5ae/Nr6ZziF2yJ02m7WoE237FOWW0UXPoExMO3kjL//9gRoB7M7pVtnWHPSTMOYzxw==" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://blog.ogenki.io/css/styles.a556cef0edd8ecd9821e661f7f201d84cc18d0c6435703889db2949aea0eccb84b7ac9a2bb49093b03f5e7d9ce21c23c705efd6dcbd7e8018afae9a9f32ca095.css integrity="sha512-pVbO8O3Y7NmCHmYffyAdhMwY0MZDVwOInbKUmuoOzLhLesmiu0kJOwP159nOIcI8cF79bcvX6AGK+ump8yyglQ==" crossorigin=anonymous></head><body data-code=21 data-lines=false id=documentTop data-lang=en><header class=nav_header><nav class=nav><a href=https://blog.ogenki.io/ class="nav_brand nav_item" title=Ogenki><img src=https://blog.ogenki.io/logos/logo.png class=logo alt=Ogenki><div class=nav_close><div><svg class="icon"><title>open-menu</title><use xlink:href="#open-menu"/></svg>
<svg class="icon"><title>closeme</title><use xlink:href="#closeme"/></svg></div></div></a><div class='nav_body nav_body_left'><div class=nav_parent><a href=https://blog.ogenki.io/ class=nav_item title=Home>Home</a></div><div class=nav_parent><a href=https://blog.ogenki.io/ class=nav_item title=Links>Links <img src=https://blog.ogenki.io/icons/caret-icon.svg alt=icon class=nav_icon></a><div class=nav_sub><span class=nav_child></span>
<a href=https://bsky.app/profile/smana.dev class="nav_child nav_item" title=Bluesky>Bluesky</a>
<a href=https://www.linkedin.com/in/sma%C3%AFne-kahlouch-44374110/ class="nav_child nav_item" title=LinkedIn>LinkedIn</a></div></div><div class=nav_parent><a href=https://blog.ogenki.io/about/ class=nav_item title=About>About</a></div><div class=nav_parent><a href=# class=nav_item>üåê</a><div class=nav_sub><span class=nav_child></span>
<a href=https://blog.ogenki.io/ class="nav_child nav_item">English</a>
<a href=https://blog.ogenki.io/fr/ class="nav_child nav_item">Fran√ßais</a></div></div><div class=follow><a href=https://github.com/Smana><svg class="icon"><title>github</title><use xlink:href="#github"/></svg>
</a><a href=https://www.linkedin.com/in/sma%C3%AFne-kahlouch-44374110/><svg class="icon"><title>linkedin</title><use xlink:href="#linkedin"/></svg>
</a><a href=https://bsky.app/profile/smana.dev><svg class="icon"><title>bluesky</title><use xlink:href="#bluesky"/></svg></a><div class=color_mode><input type=checkbox class=color_choice id=mode></div></div></div></nav></header><main><div class="grid-inverse wrap content"><article class=post_content><h1 class=post_title><code>TLS</code> with Gateway API: Efficient and Secure Management of Public and Private Certificates</h1><div class=post_meta><span><svg class="icon"><title>calendar</title><use xlink:href="#calendar"/></svg>
</span><span class=post_date>01-02-2024</span>
<span class=post_time>¬∑ 15 min read</span><span>&nbsp;¬∑ <a href=https://blog.ogenki.io/tags/security/ title=security class="post_tag button button_translucent">security
</a></span><span class=page_only>&nbsp;¬∑<div class=post_share>Share on:
<a href="https://twitter.com/intent/tweet?text=%60TLS%60%20with%20Gateway%20API%3a%20Efficient%20and%20Secure%20Management%20of%20Public%20and%20Private%20Certificates&url=https%3a%2f%2fblog.ogenki.io%2fpost%2fpki-gapi%2f&tw_p=tweetbutton" class=twitter title="Share on Twitter" target=_blank rel=nofollow><svg class="icon"><title>twitter</title><use xlink:href="#twitter"/></svg>
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.ogenki.io%2fpost%2fpki-gapi%2f&t=%60TLS%60%20with%20Gateway%20API%3a%20Efficient%20and%20Secure%20Management%20of%20Public%20and%20Private%20Certificates" class=facebook title="Share on Facebook" target=_blank rel=nofollow><svg class="icon"><title>facebook</title><use xlink:href="#facebook"/></svg>
</a><a href=#linkedinshare id=linkedinshare class=linkedin title="Share on LinkedIn" rel=nofollow><svg class="icon"><title>linkedin</title><use xlink:href="#linkedin"/></svg>
</a><a href=https://blog.ogenki.io/post/pki-gapi/ title="Copy Link" class="link link_yank"><svg class="icon"><title>copy</title><use xlink:href="#copy"/></svg></a></div></span></div><div class=post_toc><h2>Overview</h2><nav id=TableOfContents><ul><li><a href=#-our-target>üéØ Our target</a></li><li><a href=#-about-lets-encrypt>üõÇ About Let's Encrypt</a></li><li><a href=#-a-private-pki-with-vault>üîê A private PKI with Vault</a><ul><li><a href=#-requirements>‚úÖ Requirements</a></li><li><a href=#-building-the-cluster>üèóÔ∏è Building the cluster</a></li><li><a href=#-configuration>üõ†Ô∏è Configuration</a></li><li><a href=#-scheduled-backups>üíæ Scheduled Backups</a></li></ul></li><li><a href=#-tls-with-gateway-api>üöÄ TLS with Gateway API</a><ul><li><a href=#-a-public-certificate>‚òÅÔ∏è A Public Certificate</a></li><li><a href=#-a-private-certificate>üè† A Private Certificate</a></li></ul></li><li><a href=#-final-thoughts>üí≠ Final Thoughts</a></li><li><a href=#-references>üîñ References</a></li></ul></nav></div><div class=post_body><p><strong>TLS encryption</strong> is an essential standard in securing services and applications, whether on the internet or within an enterprise. On the internet, using a TLS certificate validated by a recognized certification authority is crucial to ensure the confidentiality of data exchanges.</p><p>For internal communications, a private PKI (<strong>Private Public Key Infrastructure</strong>) plays a critical role in distributing and validating the certificates necessary for encrypting communications within the enterprise, thus ensuring enhanced security.</p><p>In this article, we will delve into setting up an effective and robust management of TLS certificates within an enterprise. We will explore best practices, tools, and strategies for a reliable certificate infrastructure.</p><h2 id=-our-target>üéØ Our target</h2><center><img src=pki-gapi.png width=950></center><ul><li>In order to allow users to access to our applications, we will use the <a href=https://gateway-api.sigs.k8s.io/><strong>Gateway API</strong></a> standard. (You may want to have a look at my <a href=https://blog.ogenki.io/post/cilium-gateway-api/>previous article</a> on the topic.)</li><li>In the architecture presented above, one component plays a major role: <a href=https://cert-manager.io/><strong>Cert-manager</strong></a>. Indeed, it is the central engine that will handle the generation and renewal of certificates.</li><li>For applications intended to remain internal and not exposed on the internet, we will opt for generating certificates via a <strong>private PKI</strong> with <a href=https://www.vaultproject.io/><strong>HashiCorp's Vault</strong></a>.</li><li>On the other hand, for public applications, we will use certificates issued by <a href=https://letsencrypt.org/><strong>Let's Encrypt</strong></a>.</li></ul><h2 id=-about-lets-encrypt>üõÇ About Let's Encrypt</h2><table><tr><td style=vertical-align:middle;padding-left:20px>Based on the ACME protocol (Automatic Certificate Management Environment), this solution enables <strong>automatic installation and renewal of certificates</strong>.<br><a href=https://letsencrypt.org/><strong>Let's Encrypt</strong></a> is simple to implement, free, and enhances security. However, it's important to note that the certificates have a short duration, requiring frequent renewals.<br>For more information on how it works, you can refer to this <a href=https://letsencrypt.org/how-it-works/>documentation</a>.</td><td><img src=lets-encrypt-logo.png style=width:100%></td></tr></table><h2 id=-a-private-pki-with-vault>üîê A private PKI with Vault</h2><p>A private PKI, or <strong>Private Public Key Infrastructure</strong>, is a cryptographic system used within an organization to secure data and communications. It relies on an internal <strong>Certification Authority</strong> (CA) that issues organization-specific <strong>TLS certificates</strong>.</p><p>This system enables an organization to:</p><ul><li>Fully control the identity verification and authentication procedures, and to <strong>issue certificates</strong> for internal domains, which is not feasible with Let's Encrypt.</li><li><strong>Secure internal communications</strong> and data with strong authentication and encryption within the organization.</li></ul><p>However, implementing such an infrastructure requires <strong>careful attention</strong> and the management of multiple components. Here, we'll explore one of the main features of <strong>Vault</strong>, which is initially a secret management tool but can also serve as a private PKI.</p><div class="notices tip"><div class=label>An opiniated Cloud Native platform</div><p>All the actions performed in this post come from this <a href=https://github.com/Smana/demo-cloud-native-ref><strong>git repository</strong></a></p><p>It contains the <code>Opentofu</code> code for deploying and configuring Vault as well as <strong>numerous resources</strong> that help me write my blog posts. Feel free to provide feedback or open issues... üôè</p></div><h3 id=-requirements>‚úÖ Requirements</h3><div class="notices info"><div class=label>Three-tier PKI</div><table><tr><td><img src=three-tier-pki.png alt="Generated with DALL-E" width=250 style=width:100%></td><td style=vertical-align:middle;padding-left:20px>A <strong>three-tier PKI</strong> consists of a Root Certificate Authority (CA) at the top, Intermediate CAs in the middle, and End Entities at the bottom. The Root CA issues certificates to the Intermediate CAs, and the Intermediate CAs to End Entities which in turn issue certificates to end users or devices.</br>This structure <strong>enhances security</strong> by minimizing the Root CA's exposure and simplifies management and revocation of certificates, offering a scalable and flexible solution for digital security.</td></tr></table></div><p>To enhance the security of the certificate management system, it's recommended to create an offline Root Certification Authority (Root CA). Therefore, we need to complete the following steps beforehand:</p><ul><li><p>Generate the <strong>Offline Root Certification Authority</strong>: This approach minimizes security risks by isolating the Root CA from the network.</p></li><li><p>Create an <strong>Intermediate Certification Authority</strong>: It operates under the Root CA's authority and is used to issue certificates, allowing for more flexible and secure management.</p></li><li><p>Generate the <strong>certificate for the Vault server from the Intermediate CA</strong>: This ensures a trust chain from the Root CA to the end-user certificates, through the Intermediate CA.</p></li></ul><p>By following the procedure described <a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/opentofu/openbao/cluster/docs/pki_requirements.md><strong>here</strong></a>, you should obtain the following files which will be used throughout the rest of this article. This is a suggestion based on <code>openssl</code>, and you may use the method that best suits you to achieve the same outcome.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>cd opentofu/openbao/cluster
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=err></span><span class=go>ls .tls/*.pem
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=go>.tls/bundle.pem  .tls/ca-chain.pem  .tls/intermediate-ca-key.pem  .tls/intermediate-ca.pem  .tls/root-ca-key.pem  .tls/root-ca.pem  .tls/vault-key.pem  .tls/vault.pem
</span></span></span></code></pre></div><h3 id=-building-the-cluster>üèóÔ∏è Building the cluster</h3><p>There are several methods to deploy a Vault cluster, but I couldn't find one that suited me, so I built my own by making the following decisions:</p><ul><li><p><strong>Integrated storage</strong> based on the <a href=https://raft.github.io/>Raft</a> protocol, which is particularly suited for distributed systems and ensures high resilience. Below is a table illustrating fault tolerance depending on the cluster size:</p><table><thead><tr><th>Cluster size</th><th>Failure tolerance</th></tr></thead><tbody><tr><td>1</td><td>0</td></tr><tr><td>3</td><td>1</td></tr><tr><td>5</td><td>2</td></tr><tr><td>7</td><td>3</td></tr></tbody></table><p>I chose to run a Vault cluster that consists of <strong>5 members</strong>, allowing to tolerate the failure of 2 nodes.</p></li><li><p><strong>Ephemeral node strategy with SPOT instances</strong>: The architecture exclusively comprises SPOT instances for optimal cost efficiency. The <em>Autoscaling Group</em> is configured with three distinct SPOT instance pools, each utilizing a different instance type. This strategic diversification aims to mitigate any potential failure due to a specific SPOT instance type shortage, thus ensuring high availability and a service continuity while maximizing cost efficiency.</p></li><li><p><strong>Vault Auto-Unseal feature</strong>: This function is crucial given the ephemeral nature of our nodes. It minimizes downtime and eliminates the need for manual interventions for Vault unsealing.</p></li></ul><p>This article does not aim to describe all the steps, which are available in the <a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/opentofu/openbao/cluster/docs/getting_started.md>GitHub repo documentation</a>. Here is an example of <code>Opentofu</code> variables:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=ln> 1</span><span class=cl><span class=n>name</span>                  <span class=o>=</span> <span class=s2>&#34;ogenki-vault&#34;</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=n>leader_tls_servername</span> <span class=o>=</span> <span class=s2>&#34;vault.priv.cloud.ogenki.io&#34;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=n>domain_name</span>           <span class=o>=</span> <span class=s2>&#34;priv.cloud.ogenki.io&#34;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=n>env</span>                   <span class=o>=</span> <span class=s2>&#34;dev&#34;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=n>mode</span>                  <span class=o>=</span> <span class=s2>&#34;ha&#34;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=n>region</span>                <span class=o>=</span> <span class=s2>&#34;eu-west-3&#34;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=n>enable_ssm</span>            <span class=o>=</span> <span class=kt>true</span><span class=c1>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1># Use hardened AMI
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1></span><span class=n>ami_owner</span> <span class=o>=</span> <span class=s2>&#34;xxx&#34;</span><span class=c1> # Compte AWS o√π se trouve l&#39;AMI
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span><span class=n>ami_filter</span> <span class=o>=</span> {
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=n>  &#34;name&#34;</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;*hardened-ubuntu-*&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>}
</span></span></code></pre></div><p>After completing all the steps, Vault can be accessed, and we end up with a cluster consisting of 5 nodes.</p><p><figure><picture><img loading=lazy decoding=async alt="Vault login" class="image_figure image_internal image_processed" width=2710 height=1200 src=https://blog.ogenki.io/post/pki-gapi/vault-login.gif></picture></figure></p><h3 id=-configuration>üõ†Ô∏è Configuration</h3><p>Deploying a complete platform is carried out sequentially, in <strong>distinct steps</strong>, because some operations must be done <strong>manually</strong> to ensure optimal security: The generation of the root certificate, which must be kept offline, and the initialization of Vault with the initial root token.</p><p><figure><picture><img loading=lazy decoding=async alt="Deploy sequence" class="image_figure image_internal image_processed" width=3151 height=530 src=https://blog.ogenki.io/post/pki-gapi/vault-seq.png></picture></figure></p><p>Obviously, supporting resources such as network components are required to deploy machines, then the Vault cluster can be installed and configured before considering the addition of other infrastructure elements, which will likely depend on the sensitive information stored in Vault.</p><p>The Vault configuration is applied using the <a href=https://registry.terraform.io/providers/hashicorp/vault/latest/docs>Terraform provider</a>, which authenticates using a token generated from the Vault instance. The proposal <a href=https://github.com/Smana/demo-cloud-native-ref/tree/main/opentofu/openbao/management><strong>here</strong></a> demonstrates how to configure the PKI and allow internal applications to access to Vault's API, particularly on how to configure <code>Cert-Manager</code>.</p><p>Here are the organization's specific variables:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=ln>1</span><span class=cl><span class=n>domain_name</span>      <span class=o>=</span> <span class=s2>&#34;priv.cloud.ogenki.io&#34;</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>pki_common_name</span>  <span class=o>=</span> <span class=s2>&#34;Ogenki Vault Issuer&#34;</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=n>pki_country</span>      <span class=o>=</span> <span class=s2>&#34;France&#34;</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=n>pki_organization</span> <span class=o>=</span> <span class=s2>&#34;Ogenki&#34;</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=n>pki_domains</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>  <span class=s2>&#34;cluster.local&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>7</span><span class=cl>  <span class=s2>&#34;priv.cloud.ogenki.io&#34;</span>
</span></span><span class=line><span class=ln>8</span><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>After following the procedure, the PKI is configured, and we can <strong>generate certificates</strong>.</p><p><figure><picture><img loading=lazy decoding=async alt="Vault Issuer" class="image_figure image_internal image_processed" width=2710 height=1200 src=https://blog.ogenki.io/post/pki-gapi/vault-issuer.gif></picture></figure></p><div class="notices note"><div class=label>Install the private CA on machines</div><p>Unlike public PKIs, where certificates are automatically trusted by client software, in a private PKI, the certificates need to be manually approved and installed on users devices.</p><ul><li><a href=https://ubuntu.com/server/docs/security-trust-store>Ubuntu</a></li><li><a href=https://wiki.archlinux.org/title/Transport_Layer_Security#Add_a_certificate_to_a_trust_store>Archlinux</a></li><li><a href=https://support.apple.com/guide/keychain-access/add-certificates-to-a-keychain-kyca2431/mac>macOS</a></li><li><a href=https://learn.microsoft.com/en-us/windows-server/networking/core-network-guide/cncg/server-certs/install-the-certification-authority>Windows Server</a></li></ul></div><h3 id=-scheduled-backups>üíæ Scheduled Backups</h3><p>Like any solution holding data, it is crucial to <strong>back it up</strong>. Especially for Vault which contains sensitive data: Regular backups to a secure location are therefore necessary.
The solution proposed <a href=https://github.com/Smana/demo-cloud-native-ref/tree/main/security/base/vault-snapshot><strong>here</strong></a> is simply a <em>Cronjob</em>. It uses <a href=https://www.crossplane.io/>Crossplane</a> to provision AWS resources and is broken down as follows:</p><ul><li>An <code>S3 bucket</code> for storing the snapshots</li><li>A <code>lifecycle policy</code> to keep only the last 30 backups.</li><li>The bucket is encrypted with a specific <code>KMS key</code>.</li><li>An <code>external-secret</code> to retrieve the authentication parameters of the <code>Approle</code> specific to the <em>Cronjob</em>.</li><li>A <code>Cronjob</code> that executes <a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/scripts/vault-snapshot.sh>the script available in the repo</a> and performs a snapshot as described in <a href=https://developer.hashicorp.com/vault/tutorials/standard-procedures/sop-backup>Hashicorp's documentation</a>.</li><li>An <code>IRSA role</code> that grants the pod permissions to write the snapshots to S3.</li></ul><h2 id=-tls-with-gateway-api>üöÄ TLS with Gateway API</h2><p>The aim of this post is to demonstrate practical usage with <code>Gateway-API</code> and, depending on the protocol used, <a href=https://gateway-api.sigs.k8s.io/guides/tls/>several options are available</a> for securing connections with TLS. For instance, we can use <code>Passthrough</code> to set TLS termination at the upstream (directly exposed by the pod).</br>However, for our use case, we will use the most common scenario: <strong>HTTPS at the Gateway level</strong>.</p><p>Basically we only need to specify a Kubernetes <em>secret</em> that stores the certificate.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nt>listeners</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w></span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>HTTPS</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>443</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>  </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w>    </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>Terminate</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w>    </span><span class=nt>certificateRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>foobar-tls</span><span class=w>
</span></span></span></code></pre></div><p>Let's look into this in detail, as there are a few preliminary steps in order to obtain these secrets üîç.</p><h3 id=-a-public-certificate>‚òÅÔ∏è A Public Certificate</h3><div class="notices info"><div class=label>Info</div><table><tr><td width=180><img src=https://raw.githubusercontent.com/cncf/artwork/2182b6b6a19cc9e720679f4d1ec756dad73426eb/projects/cert-manager/icon/color/cert-manager-icon-color.png style=width:80%></td><td style=vertical-align:middle;padding-left:20px><a href=https://cert-manager.io/><strong>Cert-Manager</strong> </a>is an open-source tool for managing TLS certificates in Kubernetes.</br>It is basically a Kubernetes operator that is controlled through the use of CRDs (Custom Resource Definitions): it is indeed possible to generate certificates by creating resources of type <span style="color:red;font-family:courier new,monospace">certificate</span>. Cert-manager then takes care of ensuring they are always valid and initiates a renewal when necessary.</br>It can be integrated with an <a href=https://cert-manager.io/docs/configuration/issuers/>increasing number</a> of issuers such as <strong>Let's Encrypt</strong>, Venafi, Google, <strong>Vault</strong>, etc.</td></tr></table></div><p>In order to configure Cert-manager with Let's Encrypt we'll create a <code>ClusterIssuer</code>.</br>‚ÑπÔ∏è In the context of cert-manager, an <code>Issuer</code> is a Kubernetes resource that generates and manages certificates within a specific namespace, while a <code>ClusterIssuer</code> is a global resource that operates at the cluster level and can manage certificates across all namespaces.</p><p><a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/security/base/cert-manager/le-clusterissuer-prod.yaml>security/base/cert-manager/le-clusterissuer-prod.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>cert-manager.io/v1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIssuer</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>letsencrypt-prod</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>  </span><span class=nt>acme</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=nt>email</span><span class=p>:</span><span class=w> </span><span class=l>mymail@domain.tld</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=l>https://acme-v02.api.letsencrypt.org/directory</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=nt>privateKeySecretRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ogenki-issuer-account-key</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span><span class=nt>solvers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span>- <span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>          </span><span class=nt>dnsZones</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>            </span>- <span class=s2>&#34;cloud.ogenki.io&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>        </span><span class=nt>dns01</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>          </span><span class=nt>route53</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>            </span><span class=nt>region</span><span class=p>:</span><span class=w> </span><span class=l>eu-west-3</span><span class=w>
</span></span></span></code></pre></div><ul><li>We are using the production instance of Let's Encrypt here, which is subject to certain rules, and it is recommended to start your tests on the <strong>staging instance</strong>.</li><li>The email address is used to receive <strong>notifications</strong>, such as the need for renewal.</li><li>An <code>ogenki-issuer-account-key</code> key is generated and used to authenticate with the ACME server.</li><li>The mechanism that proves the legitimacy of a certificate request is done through <strong>DNS resolution</strong>.</li></ul><p>Now, how can we call this <code>ClusterIssuer</code> from a <code>Gateway-API</code> resource?
It turns out there is a very simple integration through the use of an <strong>annotation</strong> at the <code>Gateway</code> level. This solution is experimental and requires a specific parameter during the deployment of cert-manager.</p><p><a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/security/base/cert-manager/helmrelease.yaml>security/base/cert-manager/helmrelease.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>helm.toolkit.fluxcd.io/v2beta2</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HelmRelease</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cert-manager</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>security</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w>  </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>9</span><span class=cl><span class=w>    </span><span class=nt>featureGates</span><span class=p>:</span><span class=w> </span><span class=l>ExperimentalGatewayAPISupport=true</span><span class=w>
</span></span></span></code></pre></div><p>It's also necessary to grant permissions to the Cert-manager controller to interact with Route53 to complete the DNS challenge. <a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/security/base/cert-manager/irsa.yaml>Here</a>, I'm using a Crossplane <code>Composition</code>. (‚ÑπÔ∏è If you want to delve into <code>Crossplane</code>, it's <a href=https://blog.ogenki.io/post/crossplane_composition_functions/>over here</a>.)</p><p>Then, the annotation and the target <em>secret</em> need to be specified in the Gateway manifest.</p><p><a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/infrastructure/base/gapi/platform-public-gateway.yaml>infrastructure/base/gapi/platform-public-gateway.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>gateway.networking.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Gateway</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>platform-public</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=nt>cert-manager.io/cluster-issuer</span><span class=p>:</span><span class=w> </span><span class=l>letsencrypt-prod</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span><span class=nt>gatewayClassName</span><span class=p>:</span><span class=w> </span><span class=l>cilium</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>  </span><span class=nt>listeners</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>      </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;*.${domain_name}&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>13</span><span class=cl><span class=w>      </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>14</span><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>Terminate</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>15</span><span class=cl><span class=w>        </span><span class=nt>certificateRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>16</span><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>platform-public-tls</span><span class=w>
</span></span></span></code></pre></div><p>When the Gateway is created, a certificate is generated. This certificate uses the <code>ClusterIssuer</code> <em>letsencrypt-prod</em> mentioned above.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln> 1</span><span class=cl><span class=go>kubectl describe certificate -n infrastructure platform-public-tls
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=go>Name:         platform-public-tls
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=go>Namespace:    infrastructure
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=go>API Version:  cert-manager.io/v1
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=go>Kind:         Certificate
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=go>...
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=go>Spec:
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=go>  Dns Names:
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=go>    *.cloud.ogenki.io
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=go>  Issuer Ref:
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=go>    Group:      cert-manager.io
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=go>    Kind:       ClusterIssuer
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=go>    Name:       letsencrypt-prod
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=go>  Secret Name:  platform-public-tls
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=go>  Usages:
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=go>    digital signature
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=go>    key encipherment
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=go>Status:
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=go>  Conditions:
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=go>    Last Transition Time:  2024-01-24T20:43:26Z
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=go>    Message:               Certificate is up to date and has not expired
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=go>    Observed Generation:   1
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=go>    Reason:                Ready
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=go>    Status:                True
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=go>    Type:                  Ready
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=go>  Not After:               2024-04-23T19:43:24Z
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=go>  Not Before:              2024-01-24T19:43:25Z
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=go>  Renewal Time:            2024-03-24T19:43:24Z
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=go>  Revision:                1
</span></span></span></code></pre></div><p>Finally, after a few seconds, a Kubernetes secret is created containing the certificate. This is a _secret of type <code>tls</code> which contains these files: <code>tls.crt</code>, <code>tls.key</code>, and <code>ca.crt</code>.</p><div class="notices tip"><div class=label>The view-cert plugin</div><p>The certificates generated by cert-manager are stored in <strong>Kubernetes secrets</strong>. Although it is possible to extract them using <code>base64</code> and <code>openssl</code> commands, why not make life easier?
I am a command line guy and I regularly use the <a href=https://github.com/lmolas/kubectl-view-cert>view-cert</a> plugin, which displays a summary of <code>tls</code> type secrets.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln> 1</span><span class=cl><span class=go>kubectl view-cert -n infrastructure platform-public-tls
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=go>[
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=go>    {
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=go>        &#34;SecretName&#34;: &#34;platform-public-tls&#34;,
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=go>        &#34;Namespace&#34;: &#34;infrastructure&#34;,
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=go>        &#34;Version&#34;: 3,
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=go>        &#34;SerialNumber&#34;: &#34;35f659ad03e437805fbf48111b74738efe3&#34;,
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=go>        &#34;Issuer&#34;: &#34;CN=R3,O=Let&#39;s Encrypt,C=US&#34;,
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=go>        &#34;Validity&#34;: {
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=go>            &#34;NotBefore&#34;: &#34;2024-01-28T09:41:35Z&#34;,
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=go>            &#34;NotAfter&#34;: &#34;2024-04-27T09:41:34Z&#34;
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=go>        },
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=go>        &#34;Subject&#34;: &#34;CN=*.cloud.ogenki.io&#34;,
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=go>        &#34;IsCA&#34;: false
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=go>    }
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=go>]
</span></span></span></code></pre></div><p>It can be installed using <a href=https://krew.sigs.k8s.io/>krew</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>kubectl krew install view-cert
</span></span></span></code></pre></div></div><h3 id=-a-private-certificate>üè† A Private Certificate</h3><p>Creating <strong>private certificates using Vault</strong> is pretty similar to the above method, with slights differences. We also need to define a <code>ClusterIssuer</code>:</p><p><a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/security/base/cert-manager/le-clusterissuer-prod.yaml>security/base/cert-manager/vault-clusterissuer.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>cert-manager.io/v1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIssuer</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>vault</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>security</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>vault</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=l>https://vault.priv.cloud.ogenki.io:8200</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>pki_private_issuer/sign/ogenki</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>    </span><span class=nt>caBundle</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBDRVJUSUZJQ0...</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span><span class=nt>auth</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span><span class=nt>appRole</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>approle</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>        </span><span class=nt>roleId</span><span class=p>:</span><span class=w> </span><span class=l>f8363d0f-b7db-9b08-67ab-8425ab527587</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>        </span><span class=nt>secretRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cert-manager-vault-approle</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>          </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>secretId</span><span class=w>
</span></span></span></code></pre></div><ul><li>The URL specified is that of the Vault server. It must be accessible from the pods within Kubernetes.</li><li>The <code>path</code> in Vault is part of the <a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/opentofu/openbao/management/roles.tf>Vault configuration phase</a>. It refers to the role authorized to generate certificates.</li><li>Here, we are using authentication via an <a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/opentofu/openbao/management/docs/approle.md>Approle</a>.</li></ul><p>For more details on all the actions necessary for configuring Cert-Manager with Vault, refer to <a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/opentofu/openbao/management/docs/cert-manager.md>this procedure</a>.</p><p>The main difference with the method used for Let's Encrypt lies in the fact that <strong>the certificate must be explicitly created</strong>. Indeed, the previous method allowed for automatic creation with an annotation.</p><p><a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/infrastructure/base/gapi/platform-private-gateway-certificate.yaml>infrastructure/base/gapi/platform-private-gateway-certificate.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>cert-manager.io/v1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Certificate</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>private-gateway-certificate</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>  </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class=l>private-gateway-tls</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>duration</span><span class=p>:</span><span class=w> </span><span class=l>2160h</span><span class=w> </span><span class=c># 90d</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span><span class=nt>renewBefore</span><span class=p>:</span><span class=w> </span><span class=l>360h</span><span class=w> </span><span class=c># 15d</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>  </span><span class=nt>commonName</span><span class=p>:</span><span class=w> </span><span class=l>private-gateway.priv.cloud.ogenki.io</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>  </span><span class=nt>dnsNames</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span>- <span class=l>gitops-${cluster_name}.priv.${domain_name}</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span>- <span class=l>grafana-${cluster_name}.priv.${domain_name}</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>    </span>- <span class=l>harbor.priv.${domain_name}</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>  </span><span class=nt>issuerRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>vault</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIssuer</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>    </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>cert-manager.io</span><span class=w>
</span></span></span></code></pre></div><p>As we can see, this certificate is used to serve certificates for <code>weave-gitops</code>, <code>grafana</code>, and <code>harbor</code> applications. It has a validity period of 90 days and will be automatically renewed 15 days before its expiration.</p><p>A few seconds after the <code>certificate</code> creation, a Kubernetes <em>secret</em> is generated.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln> 1</span><span class=cl><span class=go>kubectl describe certificates -n infrastructure private-gateway-certificate
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=go>Name:         private-gateway-certificate
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=go>Namespace:    infrastructure
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=go>API Version:  cert-manager.io/v1
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=go>Kind:         Certificate
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=go>...
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=go>Spec:
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=go>  Common Name:  private-gateway.priv.cloud.ogenki.io
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=go>  Dns Names:
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=go>    gitops-mycluster-0.priv.cloud.ogenki.io
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=go>    grafana-mycluster-0.priv.cloud.ogenki.io
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=go>    harbor.priv.cloud.ogenki.io
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=go>  Duration:  2160h0m0s
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=go>  Issuer Ref:
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=go>    Group:       cert-manager.io
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=go>    Kind:        ClusterIssuer
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=go>    Name:        vault
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=go>  Renew Before:  360h0m0s
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=go>  Secret Name:   private-gateway-tls
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=go>Status:
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=go>  Conditions:
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=go>    Last Transition Time:  2024-01-27T19:54:57Z
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=go>    Message:               Certificate is up to date and has not expired
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=go>    Observed Generation:   1
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=go>    Reason:                Ready
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=go>    Status:                True
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=go>    Type:                  Ready
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=go>  Not After:               2024-04-26T19:54:57Z
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=go>  Not Before:              2024-01-27T19:54:27Z
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=go>  Renewal Time:            2024-04-11T19:54:57Z
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=go>  Revision:                1
</span></span></span><span class=line><span class=ln>32</span><span class=cl><span class=go>Events:
</span></span></span><span class=line><span class=ln>33</span><span class=cl><span class=go>  Type    Reason     Age   From                                       Message
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=go>  ----    ------     ----  ----                                       -------
</span></span></span><span class=line><span class=ln>35</span><span class=cl><span class=go>  Normal  Issuing    41m   cert-manager-certificates-trigger          Issuing certificate as Secret does not exist
</span></span></span><span class=line><span class=ln>36</span><span class=cl><span class=go>  Normal  Generated  41m   cert-manager-certificates-key-manager      Stored new private key in temporary Secret resource &#34;private-gateway-certificate-jggkv&#34;
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=go>  Normal  Requested  41m   cert-manager-certificates-request-manager  Created new CertificateRequest resource &#34;private-gateway-certificate-1&#34;
</span></span></span><span class=line><span class=ln>38</span><span class=cl><span class=go>  Normal  Issuing    38m   cert-manager-certificates-issuing          The certificate has been successfully issued
</span></span></span></code></pre></div><p>Finally, we just have to use this secret in the declaration of the private <code>Gateway</code>.</p><p><a href=https://github.com/Smana/demo-cloud-native-ref/blob/main/infrastructure/base/gapi/platform-private-gateway.yaml>infrastructure/base/gapi/platform-private-gateway.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>gateway.networking.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Gateway</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>platform-private</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>  </span><span class=nt>gatewayClassName</span><span class=p>:</span><span class=w> </span><span class=l>cilium</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>listeners</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class="line hl"><span class=ln> 9</span><span class=cl><span class=w>      </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;*.priv.${domain_name}&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>      </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>Terminate</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>        </span><span class=nt>certificateRefs</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>14</span><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>private-gateway-tls</span><span class=w>
</span></span></span></code></pre></div><p>We can <strong>verify</strong> the certification authority using the <code>curl</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>curl --verbose -k https://gitops-mycluster-0.priv.cloud.ogenki.io 2&gt;&amp;1 | grep &#39;issuer:&#39;
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>*  issuer: O=Ogenki; CN=Ogenki Vault Issuer
</span></span></span></code></pre></div><h2 id=-final-thoughts>üí≠ Final Thoughts</h2><p>‚ùì Who hasn't experienced an incident related to certificate renewal?
‚ùì How to achieve a security level that meets enterprise standards?
‚ùì How can we simplify operational tasks related to TLS certificates maintenance?</p><p>This article has explored a concrete answer to these questions. Thanks to the automation built with <strong>Cert-manager</strong>, operational tasks are minimized while enhancing the security level.</p><p>The setup process for <strong>Let's Encrypt</strong> and the <code>Gateway API</code> is incredibly straightforward! Furthermore, the level of security that <strong>Vault</strong> offers for internal communications is certainly worth taking into account. However, it's clear that implementing multiple components requires meticulous attention during the setup of this entire infrastructure to ensure optimal security is maintained.</p><div class="notices warning"><div class=label>Considerations for Production</div><p>It's important to recall some recommendations and best practices before considering a production deployment. To keep this article readable, some points have not been addressed, but it is <strong>crucial</strong> to include them in your strategy:</p><ul><li>Keep the <strong>root certificate offline</strong>. In other words, it's imperative to store it on a non-connected medium to protect it from any potential threats.</li><li>The <strong>revocation</strong> of the root or intermediate CA wasn't discussed. As well as the provision of a revocation list (Certificate Revocation List).</li><li>Access to the Vault API must be rigorously <strong>restricted to a private network</strong>. You should take a look at my <a href=https://blog.ogenki.io/post/tailscale/>article on Tailscale</a>.</li><li>Also note that I didn't talk about authentication at all, but it's essential to set up an <strong>identity provider</strong> from the start and enable multi-factor authentication (<strong>MFA</strong>) to enhance security. Moreover, it's advisable to revoke Vault's <strong>root token</strong> once adequate authentication and permissions are in place. If necessary, the token can be regenerated following the procedure available <a href=https://developer.hashicorp.com/vault/tutorials/operations/generate-root>here</a>.</li><li>The default Opentofu AMI value for the AMI (AWS Instance Image) deploys an Ubuntu from Canonical. It's recommended to use one that has been <strong>hardened</strong>. I built mine using this <a href=https://github.com/konstruktoid/hardened-images>project</a>.</li><li>To be able to initialize Vault, a command must be run on the instance, which justifies the use of <a href=https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-sessions-start.html><strong>SSM</strong></a>. However, it's advisable to <strong>disable</strong> it when the initialization phase is over (<code>enable_ssm: false</code> in the Opentofu variables).</li><li>Send <strong>audit logs</strong> to a <a href=https://en.wikipedia.org/wiki/Security_information_and_event_management>SIEM</a> to be able to detect suspicious behaviors.</li><li><strong>Alert</strong> before the certificates expire. For example, you can use <a href=https://github.com/enix/x509-certificate-exporter>this exporter</a> Prometheus open-sourced by the folks at Enix üòâ. This is an additional safety measure, knowing that the proposed architecture makes everything automated.</li><li>Pay <strong>special attention to KMS keys</strong>: the one used to unseal Vault, but also the one that allows creating snapshots. They are vital for restoring your backups.</li><li><em>"A backup that's not verified is worthless"</em>: Therefore, construct a workflow that will <strong>verify the consistency of data</strong> in Vault. This might be the subject of another article, stay tuned!</li><li>Organize periodic disaster recovery (<strong>DR</strong>) exercises to ensure your ability to rebuild the entire system from scratch, making sure you have all the necessary documentation and tools.</li></ul></div><h2 id=-references>üîñ References</h2><p><strong>Github Issues</strong></p><ul><li>Cert-manager and Vault: <a href=https://github.com/cert-manager/cert-manager/issues/6632>"The CA full chain is not included into the ca.crt"</a></li></ul><p><strong>Blog posts</strong></p><ul><li><a href=https://www.ssl.com/article/private-vs-public-pki-building-an-effective-plan/>Private vs Public PKI: Building an Effective Plan</a> (Author: Nick Naziridis)</li><li><a href=https://www.ssl.com/article/pki-best-practices-for-2023/>PKI Best practices for 2023</a></li><li><a href=https://sestegra.medium.com/build-an-internal-pki-with-vault-f7179306f18c>Build an Internal PKI with Vault</a> (Author: St√©phane Este-Gracias)</li></ul><p><strong>Hashicorp Documentation</strong></p><ul><li>Regarding the integrated Raft storage:<ul><li><a href=https://developer.hashicorp.com/vault/tutorials/day-one-raft/raft-reference-architecture>Reference Architecture</a></li><li><a href=https://developer.hashicorp.com/vault/tutorials/day-one-raft/raft-deployment-guide>Deployment Guide</a></li><li><a href=https://developer.hashicorp.com/vault/tutorials/raft/raft-storage-aws>AWS</a></li></ul></li><li><a href=https://developer.hashicorp.com/vault/tutorials/day-one-raft/production-hardening>Production hardening</a></li><li><a href=https://developer.hashicorp.com/vault/tutorials/secrets-management/pki-engine-external-ca>PKI</a></li></ul></div><div class=post_comments></div><div class=post_i18n><h3 class=mb-0>Translations:</h3><nav class=tags_nav><a href=https://blog.ogenki.io/fr/post/pki-gapi/ class="post_tag button button_translucent">Fran√ßais</a></nav></div></article><aside class=sidebar><section class=sidebar_inner><br><div class=search><input type=search class="search_field form_field" placeholder=Search... id=find autocomplete=off data-scope=post>
<label for=find class=search_label><svg class="icon"><title>search</title><use xlink:href="#search"/></svg></label><div class="search_results results"></div></div><div class=author_header><img src=https://blog.ogenki.io/images/smana.jpg alt="Smaine Kahlouch photo"><h2>Smaine Kahlouch</h2></div><div class=author_bio>Lead SRE/DevOps, Team leader, Open Source enthusiast.</div><a href=https://blog.ogenki.io/about/ class="button mt-1" role=button title='Read More'>Read More</a><h2 class=mt-4>Featured Posts</h2><ul><li><a href=https://blog.ogenki.io/post/series/observability/postgresql/ class=nav-link title="`PostgreSQL`: From Metrics to Query Plan Analysis"><code>PostgreSQL</code>: From Metrics to Query Plan Analysis</a></li><li><a href=https://blog.ogenki.io/post/series/observability/logs/ class=nav-link title="`VictoriaLogs`: What if logs management became simple and performant?"><code>VictoriaLogs</code>: What if logs management became simple and performant?</a></li><li><a href=https://blog.ogenki.io/post/series/observability/alerts/ class=nav-link title="`VictoriaMetrics` : Effective alerts, from theory to practice üõ†Ô∏è"><code>VictoriaMetrics</code> : Effective alerts, from theory to practice üõ†Ô∏è</a></li><li><a href=https://blog.ogenki.io/post/series/observability/metrics/ class=nav-link title="Harness the Power of `VictoriaMetrics` and `Grafana` Operators for Metrics Management">Harness the Power of <code>VictoriaMetrics</code> and <code>Grafana</code> Operators for Metrics Management</a></li><li><a href=https://blog.ogenki.io/post/pki-gapi/ class=nav-link title="`TLS` with Gateway API: Efficient and Secure Management of Public and Private Certificates"><code>TLS</code> with Gateway API: Efficient and Secure Management of Public and Private Certificates</a></li></ul><h2 class=mt-4>Recent Posts</h2><ul class=flex-column><li><a href=https://blog.ogenki.io/post/dagger-intro/ class=nav-link title="`Dagger`: The missing piece of the developer experience?"><code>Dagger</code>: The missing piece of the developer experience?</a></li><li><a href=https://blog.ogenki.io/post/crossplane_composition_functions/ class=nav-link title="Going Further with `Crossplane`: Compositions and Functions">Going Further with <code>Crossplane</code>: Compositions and Functions</a></li><li><a href=https://blog.ogenki.io/post/tailscale/ class=nav-link title="Beyond Traditional VPNs: Simplifying Cloud Access with `Tailscale`">Beyond Traditional VPNs: Simplifying Cloud Access with <code>Tailscale</code></a></li><li><a href=https://blog.ogenki.io/post/cilium-gateway-api/ class=nav-link title="`Gateway API`: Can I replace my Ingress Controller with `Cilium`?"><code>Gateway API</code>: Can I replace my Ingress Controller with <code>Cilium</code>?</a></li><li><a href=https://blog.ogenki.io/post/terraform-controller/ class=nav-link title="Applying GitOps Principles to Infrastructure: An overview of `tf-controller`">Applying GitOps Principles to Infrastructure: An overview of <code>tf-controller</code></a></li><li><a href=https://blog.ogenki.io/post/cnpg/ class=nav-link title="`CloudNativePG`: An easy way to run PostgreSQL on Kubernetes"><code>CloudNativePG</code>: An easy way to run PostgreSQL on Kubernetes</a></li><li><a href=https://blog.ogenki.io/post/devflux/ class=nav-link title="100% `GitOps` using Flux">100% <code>GitOps</code> using Flux</a></li><li><a href=https://blog.ogenki.io/post/crossplane_k3d/ class=nav-link title="My Kubernetes cluster (GKE) with `Crossplane`">My Kubernetes cluster (GKE) with <code>Crossplane</code></a></li></ul><div><h2 class="mt-4 taxonomy" id=categories-section>Categories</h2><nav class=tags_nav><a href=https://blog.ogenki.io/categories/containers/ class="post_tag button button_translucent" title=containers>CONTAINERS
<span class=button_tally>7</span>
</a><a href=https://blog.ogenki.io/categories/devxp/ class="post_tag button button_translucent" title=devxp>DEVXP
<span class=button_tally>6</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=series-section>Series</h2><nav class=tags_nav><a href=https://blog.ogenki.io/series/workshop-kubernetes/ class="post_tag button button_translucent" title="workshop kubernetes">WORKSHOP KUBERNETES
<span class=button_tally>7</span>
</a><a href=https://blog.ogenki.io/series/workshop-helm/ class="post_tag button button_translucent" title="workshop helm">WORKSHOP HELM
<span class=button_tally>6</span>
</a><a href=https://blog.ogenki.io/series/observability/ class="post_tag button button_translucent" title=observability>OBSERVABILITY
<span class=button_tally>4</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=tags-section>Tags</h2><nav class=tags_nav><a href=https://blog.ogenki.io/tags/kubernetes/ class="post_tag button button_translucent" title=kubernetes>KUBERNETES
<span class=button_tally>15</span>
</a><a href=https://blog.ogenki.io/tags/helm/ class="post_tag button button_translucent" title=helm>HELM
<span class=button_tally>6</span>
</a><a href=https://blog.ogenki.io/tags/infrastructure/ class="post_tag button button_translucent" title=infrastructure>INFRASTRUCTURE
<span class=button_tally>4</span>
</a><a href=https://blog.ogenki.io/tags/observability/ class="post_tag button button_translucent" title=observability>OBSERVABILITY
<span class=button_tally>4</span>
</a><a href=https://blog.ogenki.io/tags/devxp/ class="post_tag button button_translucent" title=devxp>DEVXP
<span class=button_tally>3</span>
</a><a href=https://blog.ogenki.io/tags/data/ class="post_tag button button_translucent" title=data>DATA
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/gitops/ class="post_tag button button_translucent" title=gitops>GITOPS
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/network/ class="post_tag button button_translucent" title=network>NETWORK
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/security/ class="post_tag button button_translucent" title=security>SECURITY
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/index/ class="post_tag button button_translucent" title=index>INDEX
<span class=button_tally>1</span>
</a><a href=https://blog.ogenki.io/tags/local/ class="post_tag button button_translucent" title=local>LOCAL
<span class=button_tally>1</span>
</a><a href=https://blog.ogenki.io/tags/tooling/ class="post_tag button button_translucent" title=tooling>TOOLING
<span class=button_tally>1</span></a></nav></div></section></aside></div></main><svg width="0" height="0" class="hidden"><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter"><path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68.0 01-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043.0-1.924.366-2.643 1.078A3.56 3.56.0 008.766 5.383c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846.0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47.0.929.273 1.705.82 2.388a3.623 3.623.0 002.115 1.291c-.312.08-.641.118-.979.118-.312.0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652.0 002.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422.0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139.0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77.0 001.172-4.892v-.468a7.788 7.788.0 001.84-1.921 8.142 8.142.0 01-2.11.593z"/></symbol><symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar"><path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916.0 1e2v352c0 33.084 26.916 60 60 60h392c33.084.0 60-26.916 60-60V1e2c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028.0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028.0 20 8.972 20 20v48z"/><path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github"><path d="M255.968 5.329C114.624 5.329.0 120.401.0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384.0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008.0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992.0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584.0 34.368-.32 62.08-.32 70.496.0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab"><path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6.0L12.3 74.8z"/><path d="M12.3 74.7.5 111c-1 3.2.0 6.8 3 8.8l101.6 74-92.5-119z"/><path d="M105 193.7l-38.6-119h-54l92.7 119z"/><path d="M105 193.7l38.7-119H66.4l38.7 119z"/><path d="M105 193.7l38.7-119H198l-93 119z"/><path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/><path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6.0L198 74.8z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss"><circle cx="3.429" cy="20.571" r="3.429"/><path d="M11.429 24h4.57C15.999 15.179 8.821 8.001.0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"/><path d="M24 24C24 10.766 13.234.0.0.0v4.571c10.714.0 19.43 8.714 19.43 19.429z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h362c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top"><path d="M604.501 440.509 325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298.0 36.323s26.223 10.024 36.222.0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221.0 9.999-10.023 9.999-26.298.0-36.323z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly"><path d="M504.971 239.029 448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c19.851.0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002.0 004e2 320v108c0 19.851-16.149 36-36 36h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c46.318.0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568.0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255.0 24-10.745 24-24S205.255.0 192 0h-44c-46.318.0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568.0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255.0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851.0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002.0 00112 192z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy"><path d="M23 2.75A2.75 2.75.0 0020.25.0H8.75A2.75 2.75.0 006 2.75v13.5A2.75 2.75.0 008.75 19h11.5A2.75 2.75.0 0023 16.25zM18.25 14.5h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5z"/><path d="M8.75 20.5A4.255 4.255.0 014.5 16.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752.0 001 5.25v16A2.752 2.752.0 003.75 24h12a2.752 2.752.0 002.75-2.75v-.75z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme"><path d="M284.286 256.002 506.143 34.144c7.811-7.811 7.811-20.475.0-28.285-7.811-7.81-20.475-7.811-28.285.0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285.0-7.81 7.811-7.811 20.475.0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475.0 28.285a19.938 19.938.0 0014.143 5.857 19.94 19.94.0 0014.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475.0-28.285L284.286 256.002z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu"><path d="M492 236H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954.0 96s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram"><path d="M12 2.163c3.204.0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849.0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204.0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849.0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741.0 8.333.014 7.053.072c-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.668.072 4.948c.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24s3.668-.014 4.948-.072c4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403.0-6.162 2.759-6.162 6.162S8.597 18.163 12 18.163s6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zM12 16c-2.209.0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796.0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795.0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="youtube"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow"><path d="M21 27v-8h3v11H0V19h3v8h18z"/><path d="M17.1.2 15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8 13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord"><path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527.41542 45.5603.39851 45.468.440769 45.4204.525289 44.7963 1.6353 44.105 3.0834 43.6209 4.2216c-5.4572-.817-10.8864-.817-16.2317.0C26.905 3.0581 26.1886 1.6353 25.5617.525289 25.5141.443589 25.4218.40133 25.3294.41542c-5.071.87338-9.9237 2.40318-14.4518 4.48238C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795 1.57795 18.7309-.943561 32.1443.293408 45.3914.299005 45.4562.335386 45.5182.385761 45.5576 6.45866 50.0174 12.3413 52.7249 18.1147 54.5195 18.2071 54.5477 18.305 54.5139 18.3638 54.4378 19.7295 52.5728 20.9469 50.6063 21.9907 48.5383 22.0523 48.4172 21.9935 48.2735 21.8676 48.2256 19.9366 47.4931 18.0979 46.6 16.3292 45.5858 16.1893 45.5041 16.1781 45.304 16.3068 45.2082 16.679 44.9293 17.0513 44.6391 17.4067 44.3461 17.471 44.2926 17.5606 44.2813 17.6362 44.3151c11.6196 5.3051 24.1992 5.3051 35.6817.0C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433 53.9057 44.6363 54.2779 44.9293 54.6529 45.2082 54.7816 45.304 54.7732 45.5041 54.6333 45.5858c-1.7687 1.0339-3.6074 1.9073-5.5412 2.637C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383c1.0662 2.0651 2.2836 4.0316 3.6241 5.8967C52.6519 54.5139 52.7526 54.5477 52.845 54.5195c5.8014-1.7946 11.684-4.5021 17.7569-8.9619C70.6551 45.5182 70.6887 45.459 70.6943 45.3942 72.1747 30.0791 68.2147 16.7757 60.1968 4.9823 60.1772 4.9429 60.1437 4.9147 60.1045 4.8978zM23.7259 37.3253c-3.4983.0-6.3808-3.2117-6.3808-7.156s2.8266-7.156 6.3808-7.156c3.5821.0 6.4367 3.2399 6.3807 7.156.0 3.9443-2.8266 7.156-6.3807 7.156zm23.5919.0c-3.4982.0-6.3807-3.2117-6.3807-7.156s2.8265-7.156 6.3807-7.156c3.5822.0 6.4367 3.2399 6.3808 7.156.0 3.9443-2.7986 7.156-6.3808 7.156z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 18" id="mastodon"><path fill="#fff" d="m15.054695 9.8859583c-.22611 1.1632697-2.02517 2.4363497-4.09138 2.6830797-1.0774504.12856-2.1382704.24673-3.2694704.19484-1.84996-.0848-3.30971-.44157-3.30971-.44157.0.1801.0111.35157.0333.51194.24051 1.82571 1.81034 1.93508 3.29737 1.98607 1.50088.0514 2.8373104-.37004 2.8373104-.37004l.0617 1.35686s-1.0498104.56374-2.9199404.66742c-1.03124.0567-2.3117-.0259-3.80308-.42069-3.23454998-.85613-3.79081998-4.304-3.87592998-7.8024197-.026-1.03871-.01-2.01815-.01-2.83732.0-3.57732 2.34385998-4.62587996 2.34385998-4.62587996 1.18184-.54277 3.20976-.77101 5.318-.7882499985409h.0518C9.8267646.01719834 11.856025.24547834 13.037775.78824834c0 0 2.34377 1.04855996 2.34377 4.62587996.0.0.0294 2.63937-.32687 4.47183"/><path fill="#000" d="m12.616925 5.6916583v4.3315297h-1.71607V5.8189683c0-.88624-.37289-1.33607-1.1187604-1.33607-.82467.0-1.23799.53361-1.23799 1.58875v2.30122h-1.70594v-2.30122c0-1.05514-.4134-1.58875-1.23808-1.58875-.74587.0-1.11876.44983-1.11876 1.33607v4.2042197h-1.71607V5.6916583c0-.88527.22541-1.58876.67817-2.10922.46689-.52047 1.07833-.78727 1.83735-.78727.87816.0 1.54317.33752 1.98288 1.01267l.42744.71655.42753-.71655c.43961-.67515 1.10463-1.01267 1.9828704-1.01267.75893.0 1.37037.2668 1.83735.78727.45268.52046.67808 1.22395.67808 2.10922"/></symbol></svg><footer class=footer><div class="footer_inner wrap pale"><img src=https://blog.ogenki.io/icons/footer.png class="icon icon_2 transparent" alt="Copyright ¬© 2021‚Äì2023, Smana https://github.io/Smana"><p>Copyright&nbsp;<span class=year></span>&nbsp;COPYRIGHT ¬© 2021‚Äì2023, SMANA HTTPS://GITHUB.IO/SMANA. All Rights Reserved</p><a class=to_top href=#documentTop><svg class="icon"><title>to-top</title><use xlink:href="#to-top"/></svg></a></div></footer><script type=text/javascript src=https://blog.ogenki.io/en/js/bundle.fb0be5bcaafc43d845951fd0966e48e5a7bf36be99ce2176c89d369bb5a8136dfb14e596d145cfa04c4c3b79232ffffd811a01eccee956d9d61cf49330e633c7.js integrity="sha512-+wvlvKr8Q9hFlR/Qlm5I5ae/Nr6ZziF2yJ02m7WoE237FOWW0UXPoExMO3kjL//9gRoB7M7pVtnWHPSTMOYzxw==" crossorigin=anonymous></script><script src=https://blog.ogenki.io/js/search.min.73cb82d8f274395dd220d6594053cd3d3d8ac8c97d874b5142a60b9744f3704d765551e0ade104d5803c66b731f5a7a00ac2cff33c8c9090ff8100169a3e2574.js></script></body></html>