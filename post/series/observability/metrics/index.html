<!doctype html><html lang=en data-figures class=page><head><title>Harness the Power of `VictoriaMetrics` and `Grafana` Operators for Metrics Management | Ogenki</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=XXXXXXXXXX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","XXXXXXXXXX")</script><meta property="og:locale" content="en"><meta property="og:locale:alternate" content="fr"><meta property="og:type" content="article"><meta name=description content="There are several solutions to collect, store, and visualize metrics. The most common combination often relies on Prometheus and Grafana. In this article, we …"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@smana.dev"><meta name=twitter:title content="Harness the Power of `VictoriaMetrics` and `Grafana` Operators for Metrics Management"><meta name=twitter:image content="https://blog.ogenki.io/post/series/observability/metrics/thumbnail.png"><meta property="og:url" content="https://blog.ogenki.io/post/series/observability/metrics/"><meta property="og:title" content="Harness the Power of `VictoriaMetrics` and `Grafana` Operators for Metrics Management"><meta property="og:description" content="There are several solutions to collect, store, and visualize metrics. The most common combination often relies on Prometheus and Grafana. In this article, we …"><meta property="og:image" content="https://blog.ogenki.io/post/series/observability/metrics/thumbnail.png"><meta name=keywords content="observability"><link rel=apple-touch-icon sizes=180x180 href=https://blog.ogenki.io/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.ogenki.io/icons/favicon-32x32.png><link rel=manifest href=https://blog.ogenki.io/icons/site.webmanifest><link rel=canonical href=https://blog.ogenki.io/post/series/observability/metrics/><link rel=preload href=https://blog.ogenki.io/css/styles.a556cef0edd8ecd9821e661f7f201d84cc18d0c6435703889db2949aea0eccb84b7ac9a2bb49093b03f5e7d9ce21c23c705efd6dcbd7e8018afae9a9f32ca095.css integrity="sha512-pVbO8O3Y7NmCHmYffyAdhMwY0MZDVwOInbKUmuoOzLhLesmiu0kJOwP159nOIcI8cF79bcvX6AGK+ump8yyglQ==" as=style crossorigin=anonymous><link rel=preload href=https://blog.ogenki.io/en/js/bundle.fb0be5bcaafc43d845951fd0966e48e5a7bf36be99ce2176c89d369bb5a8136dfb14e596d145cfa04c4c3b79232ffffd811a01eccee956d9d61cf49330e633c7.js as=script integrity="sha512-+wvlvKr8Q9hFlR/Qlm5I5ae/Nr6ZziF2yJ02m7WoE237FOWW0UXPoExMO3kjL//9gRoB7M7pVtnWHPSTMOYzxw==" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://blog.ogenki.io/css/styles.a556cef0edd8ecd9821e661f7f201d84cc18d0c6435703889db2949aea0eccb84b7ac9a2bb49093b03f5e7d9ce21c23c705efd6dcbd7e8018afae9a9f32ca095.css integrity="sha512-pVbO8O3Y7NmCHmYffyAdhMwY0MZDVwOInbKUmuoOzLhLesmiu0kJOwP159nOIcI8cF79bcvX6AGK+ump8yyglQ==" crossorigin=anonymous></head><body data-code=30 data-lines=false id=documentTop data-lang=en><header class=nav_header><nav class=nav><a href=https://blog.ogenki.io/ class="nav_brand nav_item" title=Ogenki><img src=https://blog.ogenki.io/logos/logo.png class=logo alt=Ogenki><div class=nav_close><div><svg class="icon"><title>open-menu</title><use xlink:href="#open-menu"/></svg>
<svg class="icon"><title>closeme</title><use xlink:href="#closeme"/></svg></div></div></a><div class='nav_body nav_body_left'><div class=nav_parent><a href=https://blog.ogenki.io/ class=nav_item title=Home>Home</a></div><div class=nav_parent><a href=https://blog.ogenki.io/ class=nav_item title=Links>Links <img src=https://blog.ogenki.io/icons/caret-icon.svg alt=icon class=nav_icon></a><div class=nav_sub><span class=nav_child></span>
<a href=https://bsky.app/profile/smana.dev class="nav_child nav_item" title=Bluesky>Bluesky</a>
<a href=https://www.linkedin.com/in/sma%C3%AFne-kahlouch-44374110/ class="nav_child nav_item" title=LinkedIn>LinkedIn</a></div></div><div class=nav_parent><a href=https://blog.ogenki.io/about/ class=nav_item title=About>About</a></div><div class=nav_parent><a href=# class=nav_item>🌐</a><div class=nav_sub><span class=nav_child></span>
<a href=https://blog.ogenki.io/ class="nav_child nav_item">English</a>
<a href=https://blog.ogenki.io/fr/ class="nav_child nav_item">Français</a></div></div><div class=follow><a href=https://github.com/Smana><svg class="icon"><title>github</title><use xlink:href="#github"/></svg>
</a><a href=https://www.linkedin.com/in/sma%C3%AFne-kahlouch-44374110/><svg class="icon"><title>linkedin</title><use xlink:href="#linkedin"/></svg>
</a><a href=https://bsky.app/profile/smana.dev><svg class="icon"><title>bluesky</title><use xlink:href="#bluesky"/></svg></a><div class=color_mode><input type=checkbox class=color_choice id=mode></div></div></div></nav></header><main><div class="grid-inverse wrap content"><article class=post_content><h1 class=post_title>Harness the Power of <code>VictoriaMetrics</code> and <code>Grafana</code> Operators for Metrics Management</h1><div class=post_meta><span><svg class="icon"><title>calendar</title><use xlink:href="#calendar"/></svg>
</span><span class=post_date>11-09-2024</span>
<span class=post_time>· 15 min read</span><span>&nbsp;· <a href=https://blog.ogenki.io/tags/observability/ title=observability class="post_tag button button_translucent">observability
</a></span><span class=page_only>&nbsp;·<div class=post_share>Share on:
<a href="https://twitter.com/intent/tweet?text=Harness%20the%20Power%20of%20%60VictoriaMetrics%60%20and%20%60Grafana%60%20Operators%20for%20Metrics%20Management&url=https%3a%2f%2fblog.ogenki.io%2fpost%2fseries%2fobservability%2fmetrics%2f&tw_p=tweetbutton" class=twitter title="Share on Twitter" target=_blank rel=nofollow><svg class="icon"><title>twitter</title><use xlink:href="#twitter"/></svg>
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.ogenki.io%2fpost%2fseries%2fobservability%2fmetrics%2f&t=Harness%20the%20Power%20of%20%60VictoriaMetrics%60%20and%20%60Grafana%60%20Operators%20for%20Metrics%20Management" class=facebook title="Share on Facebook" target=_blank rel=nofollow><svg class="icon"><title>facebook</title><use xlink:href="#facebook"/></svg>
</a><a href=#linkedinshare id=linkedinshare class=linkedin title="Share on LinkedIn" rel=nofollow><svg class="icon"><title>linkedin</title><use xlink:href="#linkedin"/></svg>
</a><a href=https://blog.ogenki.io/post/series/observability/metrics/ title="Copy Link" class="link link_yank"><svg class="icon"><title>copy</title><use xlink:href="#copy"/></svg></a></div></span></div><div class=post_toc><h2>Overview</h2><nav id=TableOfContents><ul><li><a href=#-what-is-a-metric>❓ What is a metric</a><ul><li><a href=#definition>Definition</a></li><li><a href=#a-glimpse-of-how-metrics-are-gathered>A Glimpse of How Metrics Are Gathered</a></li></ul></li><li><a href=#-victoriametrics-an-enhanced-prometheus>✨ VictoriaMetrics: An Enhanced Prometheus?</a></li><li><a href=#-a-modular-and-scalable-architecture>🔎 A modular and scalable architecture</a><ul><li><a href=#single-mode>Single Mode</a></li><li><a href=#high-availability>High Availability</a></li><li><a href=#cluster-mode>Cluster Mode</a></li></ul></li><li><a href=#-configuration>🛠️ Configuration</a></li><li><a href=#-visualizing-metrics-with-the-grafana-operator>📈 Visualizing Metrics with the Grafana Operator</a></li><li><a href=#-final-thoughts>💭 Final Thoughts</a></li><li><a href=#-references>🔖 References</a></li></ul></nav></div><div class=post_body><div class="notices info"><div class=label>How are our applications performing? 👁️</div><p>Once our application is deployed, it is essential to have indicators that help identify potential issues and track performance changes. Among these sources of information, <strong>metrics</strong> and <strong>logs</strong> play an essential role by providing valuable insights into the application's operation. Additionally, it is often useful to implement detailed <strong>tracing</strong> to accurately track all actions performed within the application.</p><p>In this <a href=https://blog.ogenki.io/fr/tags/observability/>series of blog posts</a>, we will explore the various areas of application monitoring. The goal is to thoroughly analyze the state of our applications, in order to improve their <strong>availability</strong> and <strong>performance</strong>, while ensuring an optimal user experience.</p></div><p>This first article focuses on <strong>collecting and visualizing metrics</strong>. We will deploy a scalable and high-performance solution to forward these metrics to a <strong>reliable and durable storage system</strong>. Then, we will see how to <strong>visualize</strong> them for analysis purposes.</p><h2 id=-what-is-a-metric>❓ What is a metric</h2><h3 id=definition>Definition</h3><p>Before collecting this so-called "metric", let's first look at its definition and characteristics:</br>A metric is a <strong>measurable</strong> data point that helps track the status and performance of an application. These data points are typically collected at <strong>regular intervals</strong>, such as the number of requests, memory usage, or error rates.</p><p>When it comes to monitoring, it is hard to avoid hearing about <a href=https://prometheus.io/>Prometheus</a>. This project has contributed to the emergence of a <strong>standard</strong> that defines how metrics are exposed, called <a href=https://github.com/OpenObservability/OpenMetrics/blob/main/specification/OpenMetrics.md><strong>OpenMetrics</strong></a>, which follows this format:</p><center><img src=raw-sample.png width=700 alt></center><ul><li><p><strong>Time Series</strong>: A unique <code>time series</code> is the combination of the metric's name and its labels. For instance, <code>request_total{code="200"}</code> and <code>request_total{code="500"}</code> are considered two distinct <em>time series</em>.</p></li><li><p><strong>Labels</strong>: <code>Labels</code> can be associated with a metric to provide more specific details. They are added after the metric's name using curly braces. Although optional, they are commonly used, especially in a Kubernetes context (pod, namespace, etc.).</p></li><li><p><strong>Value</strong>: The <code>value</code> is the numeric data collected at a specific point in time for a given time series. Depending on the <a href=https://prometheus.io/docs/concepts/metric_types/><strong>metric type</strong></a>, it represents a measured or counted value that tracks a metric's evolution over time.</p></li><li><p><strong>Timestamp</strong>: Specifies <strong>when</strong> the data was collected (in epoch format to the millisecond). If not present, it is added when the metric is retrieved.</p></li></ul><p><strong>This full line is called a<code>raw sample</code></strong>.</p><div class="notices note"><div class=label>Watch out for cardinality!</div><p>The more labels you have, the more possible combinations of them exist, which leads to an exponential increase in the number of time series. This total number of combinations is known as <strong>cardinality</strong>. High cardinality can <strong>significantly affect performance</strong>, especially by increasing memory usage and storage demands.</p><p>High cardinality also occurs when new metrics are frequently created. This phenomenon, known as <strong>churn rate</strong>, reflects the rate at which metrics appear and disappear within a system. In the context of Kubernetes, where pods are regularly created and deleted, this churn rate can contribute to the rapid increase in cardinality.</p></div><h3 id=a-glimpse-of-how-metrics-are-gathered>A Glimpse of How Metrics Are Gathered</h3><p>Now that we understand what a metric is, let's see how they are collected. Most modern solutions expose an endpoint that allows <strong>scraping metrics</strong>, meaning they are queried <strong>at regular intervals</strong>. For instance, using the Prometheus SDK, available in most programming languages, it's easy to expose an endpoint for metrics collection into our applications.</p><p>This is worth noting that Prometheus generally uses a "<strong>Pull</strong>" model, where the server periodically queries targets to retrieve metrics via these exposed endpoints. This approach helps control the frequency of data collection and prevents overloading the systems.</p><p>Let's take an example with an Nginx web server. The server is installed via the Helm chart with Prometheus support enabled. Here, the parameter <code>metrics.enabled=true</code> adds a path that exposes the metrics endpoint.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>helm install ogenki-nginx bitnami/nginx --set metrics.enabled=true
</span></span></span></code></pre></div><p>Then, we can retrieve a significant number of metrics with a simple HTTP call.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>kubectl port-forward svc/ogenki-nginx metrics &amp;
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>Forwarding from 127.0.0.1:9113 -&gt; 9113
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=err></span><span class=go>curl -s localhost:9113/metrics
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=go>...
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=go></span><span class=gp>#</span> TYPE promhttp_metric_handler_requests_total counter
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=go>promhttp_metric_handler_requests_total{code=&#34;200&#34;} 257
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=go>...
</span></span></span></code></pre></div><p>The curl command was just an example. Generally speaking, the metrics scrapping is carried out by a system responsible for <strong>storing this data</strong> so it can later be used.</br></p><center><img src=scraping-overview.png width=700 alt></center><p>ℹ️ When using <code>Prometheus</code>, an additional component is required to <strong>Push</strong> metrics from applications: <a href=https://github.com/prometheus/pushgateway>PushGateway</a>.</p><p>In this article, I’ve chosen to introduce you to <code>VictoriaMetrics</code>.</p><h2 id=-victoriametrics-an-enhanced-prometheus>✨ VictoriaMetrics: An Enhanced Prometheus?</h2><p>Like Prometheus, VictoriaMetrics is a <strong>Time Series Database</strong> (<a href=https://en.wikipedia.org/wiki/Time_series_database>TSDB</a>). These databases are designed to track and store events that <strong>change over time</strong>. Although VictoriaMetrics appeared a few years after Prometheus, they share many similarities: both are <strong>open-source</strong> databases licensed under Apache 2.0, dedicated to handling time series data. VictoriaMetrics remains fully compatible with Prometheus, using the same metric format, <code>OpenMetrics</code>, and supporting the <code>PromQL</code> query language.</p><p>Both projects are also very active, with dynamic communities and regular contributions from various companies <a href="https://ossinsight.io/analyze/prometheus/prometheus?vs=VictoriaMetrics%2FVictoriaMetrics#overview">as you can see here</a>.</p><p>Now, let’s explore the key differences and reasons why one might choose VictoriaMetrics:</p><ul><li><p><strong>Efficient storage and compression</strong>: This is likely one of the major advantages, especially when dealing with large amounts of data or needing long-term retention. With Prometheus, an additional component like <a href=https://thanos.io/>Thanos</a> is needed for this purpose. VictoriaMetrics, in the other hand, has an <strong>optimized storage engine</strong> that batches and optimizes data before writing it to disk. Furthermore, it uses <strong>powerful compression algorithms</strong>, making disk space usage much more efficient compared to Prometheus.</p></li><li><p><strong>Memory footprint</strong>: VictoriaMetrics is said to use up to 7 times less memory than a Prometheus-based solution. However, the available benchmarks are somewhat outdated, and Prometheus has since benefited from <a href=https://thenewstack.io/30-pull-requests-later-prometheus-memory-use-is-cut-in-half/>several memory optimizations</a>.</p></li><li><p><strong>MetricsQL</strong>: VictoriaMetrics extends the PromQL language with new functions. This language is also designed to be more performant, especially on large datasets.</p></li><li><p><strong>Modular architecture</strong>: VictoriaMetrics can be deployed in two modes: "Single" or "Cluster". We’ll explore this in more detail later in the article.</p></li><li><p><strong>And much more...</strong>: The points above are the key reasons I highlighted, but there are others. VictoriaMetrics can also operate in <strong>Push mode</strong>, support <strong>multitenancy</strong>, and offers additional features available in the <a href=https://docs.victoriametrics.com/enterprise/#victoriametrics-enterprise-features><strong>Enterprise version</strong></a>.</p></li></ul><div class="notices info"><div class=label>Case studies: what they say about it</div><p>On the VictoriaMetrics website, you'll find numerous <a href=https://docs.victoriametrics.com/casestudies/>testimonials and case studies</a> from companies that have migrated from other systems (such as Thanos, InfluxDB, etc.). Some examples are particularly insightful, especially those from <a href=https://www.datanami.com/2023/05/30/why-roblox-picked-victoriametrics-for-observability-data-overhaul/>Roblox</a>, <a href=https://engineering.razorpay.com/scaling-to-trillions-of-metric-data-points-f569a5b654f2>Razorpay</a>, and <a href=https://techblog.criteo.com/victoriametrics-a-prometheus-remote-storage-solution-57081a3d8e61>Criteo</a>, which handle a very large volume of metrics.</p></div><h2 id=-a-modular-and-scalable-architecture>🔎 A modular and scalable architecture</h2><div class="notices tip"><div class=label>GitOps and Kubernetes Operators</div><table><tr><td><img src=repo_gift.png style=width:80%></td><td style=vertical-align:middle;padding-left:10px width=70%><p>The remaining of this article comes from a set of configurations available in the repository <strong><a href=https://github.com/Smana/cloud-native-ref>Cloud Native Ref</a></strong>.</br>It makes use of several operators, notably those for <a href=https://github.com/VictoriaMetrics/operator>VictoriaMetrics</a> and <a href=https://github.com/grafana/grafana-operator>Grafana</a>.</p><p>The aim of this project is to <strong>quickly bootstrap a complete platform</strong> that follows best practices in terms of automation, monitoring, security, and more.</br>Comments and contributions are welcome 🙏</td></p></tr></table></div><p><code>VictoriaMetrics</code> can be deployed in various ways: The default mode is called <code>Single</code>, and as the name suggests, it involves deploying a <strong>single instance</strong> that handles read, write, and storage operations. It is recommended to start with this mode as it is <strong>optimized</strong> and meets most use cases, as explained in <a href=https://docs.victoriametrics.com/#capacity-planning>this section</a>.</p><h3 id=single-mode>Single Mode</h3><p>The deployment method chosen in this article makes use of the Helm chart <a href=https://github.com/VictoriaMetrics/helm-charts/tree/master/charts/victoria-metrics-k8s-stack><strong>victoria-metrics-k8s-stack</strong></a>, which configures multiple resources (VictoriaMetrics, Grafana, Alertmanager, some dashboards, etc.). Below is a snippet of a <a href=https://fluxcd.io/>Flux</a> configuration for the <code>Single</code> mode.</p><p><a href=https://github.com/Smana/cloud-native-ref/blob/main/observability/base/victoria-metrics-k8s-stack/helmrelease-vmsingle.yaml>observability/base/victoria-metrics-k8s-stack/helmrelease-vmsingle.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>helm.toolkit.fluxcd.io/v2</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HelmRelease</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>victoria-metrics-k8s-stack</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>observability</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>releaseName</span><span class=p>:</span><span class=w> </span><span class=l>victoria-metrics-k8s-stack</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span><span class=nt>chart</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>      </span><span class=nt>chart</span><span class=p>:</span><span class=w> </span><span class=l>victoria-metrics-k8s-stack</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>      </span><span class=nt>sourceRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HelmRepository</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>victoria-metrics</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>        </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>observability</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.25.15&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>  </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>    </span><span class=nt>vmsingle</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>      </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>        </span><span class=nt>retentionPeriod</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1d&#34;</span><span class=w> </span><span class=c># Minimal retention, for tests only</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>        </span><span class=nt>replicaCount</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>        </span><span class=nt>storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w>          </span><span class=nt>accessModes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w>            </span>- <span class=l>ReadWriteOnce</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w>          </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w>            </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w>              </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>10Gi</span><span class=w>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=w>        </span><span class=nt>extraArgs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=w>          </span><span class=nt>maxLabelsPerTimeseries</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;50&#34;</span><span class=w>
</span></span></span></code></pre></div><p>When all the Kubernetes manifests are applied, the resulting architecture looks like this:</p><center><img src=vmsingle.png width=1400 alt></center><ul><li><p>🔒 <strong>Private Access</strong>: Although not directly related to metric collection, I wanted to highlight how access to the various UIs is managed. I chose to use <a href=https://gateway-api.sigs.k8s.io/><strong>Gateway API</strong></a>, which I’ve been using for some time and have covered in <a href=https://blog.ogenki.io/tags/security/>previous blog posts</a>. An alternative would be to use a VictoriaMetrics component, <a href="https://docs.victoriametrics.com/vmauth/?highlight=vmauth">VMAuth</a>, which can act as a proxy for authorization and routing http requests, but I did not choose this option for now.</p></li><li><p>👷 <strong>VMAgent</strong>: A very lightweight agent whose main function is to <strong>gather metrics</strong> and send them to a Prometheus-compatible database. Additionally, this agent can apply <strong>filters and transformations</strong> to metrics before forwarding them. If the destination is unavailable or there is insufficient memory, it can cache data on disk.</br>VMAgent also has a web interface that lists the "Targets" being scraped.</p></li></ul><center><img src=vmagent.png width=800></center><ul><li><p>🔥 <strong>VMAlert</strong> & <strong>VMAlertManager</strong>: These components are responsible for sending notifications in case of issues (for instance when reaching a given threshold). I won’t go into further detail here as this will be covered in a <strong>future article</strong>.</p></li><li><p>⚙️ <strong>VMsingle</strong>: This is the VictoriaMetrics database deployed as a single pod that handles all operations (reading, writing, and data persistence).</p></li></ul><p>Once all pods are started, you can access the main VictoriaMetrics interface: <code>VMUI</code>. This UI provides access to a wide range of information, including the scraped metrics, the top queries, cardinality statistics, and <a href=https://docs.victoriametrics.com/#vmui>much more</a>.</p><center><video id=VMUI controls height=800 autoplay loop muted>
<source src=vmui.webm type=video/webm>Your browser does not support the video tag.</video></center><script>var video=document.getElementById("VMUI");video.playbackRate=1.8</script><h3 id=high-availability>High Availability</h3><p>To ensure we never lose sight of what's happening with our applications, the monitoring platform must always remain up and running. All VictoriaMetrics components can be configured for high availability. Depending on the desired level of redundancy, several options are available.</p><p>A straightforward approach would be to send data to <strong>two <code>Single</code> instances</strong>, duplicating the data in two different locations. Additionally, these instances could be deployed in two different regions.</p><p>It’s also recommended to <strong>deploy 2 VMAgents</strong> that scrape the same targets to ensure that no data is lost.</p><div class="notices note"><div class=label>De-duplication setting</div><p>In such an architecture, since multiple VMAgents are sending data and scraping the same targets, we end up with <strong>duplicate</strong> metrics. The <a href=https://docs.victoriametrics.com/#deduplication>De-duplication</a> feature in VictoriaMetrics ensures that <strong>only one version</strong> is retained when two raw samples are identical.</br>One parameter requires special attention: <code>-dedup.minScrapeInterval</code>. Only the <strong>most recent</strong> version is kept when identical raw samples are found within this time interval.</p><p>It is also recommended to:</p><ul><li>Set this parameter to a value equal to the <code>scrape_interval</code> defined in the Prometheus configuration.</li><li>Keep the <code>scrape_interval</code> value consistent across all scraped services.</li></ul></div><p>The diagram below shows one of the many possible combinations to ensure optimal availability.</br>⚠️ However, it's important to consider the <strong>additional costs</strong>, not only for storage and compute, but also for network transfers between zones/regions. Sometimes, having a solid <strong>backup and restore strategy</strong> is a smarter choice 😅.</p><center><img src=multi-region.png width=900 alt></center><h3 id=cluster-mode>Cluster Mode</h3><p>As mentioned earlier, in most cases, the <code>Single</code> mode is more than sufficient. It has the advantage of being easy to maintain and, with vertical scaling, it can handle <strong>nearly all use cases</strong>. There is also a <code>Cluster</code> mode, but it is only relevant in two specific cases:</p><ul><li>The need for <a href=https://docs.victoriametrics.com/cluster-victoriametrics/#multitenancy>multitenancy</a>, for example, to isolate multiple teams or customers.</li><li>When the limits of vertical scaling are reached.</li></ul><p>My configuration allows you to choose between either mode:</p><p><a href=https://github.com/Smana/cloud-native-ref/blob/main/observability/base/victoria-metrics-k8s-stack/kustomization.yaml>observability/base/victoria-metrics-k8s-stack/kustomization.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span>- <span class=l>vm-common-helm-values-configmap.yaml</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=c># Choose between single or cluster helm release</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=c># VM Single</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span>- <span class=l>helmrelease-vmsingle.yaml</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>  </span>- <span class=l>httproute-vmsingle.yaml</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>  </span><span class=c># VM Cluster</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>  </span><span class=c># - helmrelease-vmcluster.yaml</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>  </span><span class=c># - httproute-vmcluster.yaml</span><span class=w>
</span></span></span></code></pre></div><center><img src=vmcluster.png width=800 alt></center><p>In this mode, the <strong>read, write, and storage functions</strong> are separated into three distinct deployments.</p><ul><li><p>✏️ <strong>VMInsert</strong>: Distributes the data across VMStorage instances using <a href=https://en.wikipedia.org/wiki/Consistent_hashing>consistent hashing</a> based on the time series (combination of the metric name and its labels).</p></li><li><p>💾 <strong>VMStorage</strong>: Responsible for writing data to disk and returning the requested data to VMSelect.</p></li><li><p>📖 <strong>VMSelect</strong>: For each query, it retrieves the data from the VMStorages.</p></li></ul><p>The main benefit of this mode is the ability to adjust <strong>scaling</strong> according to needs. For example, if more write capacity is required, you can add more VMInsert replicas.</p><p>The initial parameter that ensures a minimum level of redundancy is <code>replicationFactor</code> set to <code>2</code>.</br>Here is a snippet of the Helm <em>values</em> for the cluster mode.</p><p><a href=https://github.com/Smana/cloud-native-ref/blob/main/observability/base/victoria-metrics-k8s-stack/helmrelease-vmcluster.yaml>observability/base/victoria-metrics-k8s-stack/helmrelease-vmcluster.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=w>    </span><span class=nt>vmcluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>      </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>        </span><span class=nt>retentionPeriod</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;10d&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>        </span><span class=nt>replicationFactor</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>        </span><span class=nt>vmstorage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>          </span><span class=nt>storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>            </span><span class=nt>volumeClaimTemplate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>              </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gp3&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>              </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>                </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>                  </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>                    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>10Gi</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>          </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>            </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>              </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>              </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>1500Mi</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>          </span><span class=nt>affinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>            </span><span class=nt>podAntiAffinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>              </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>                </span>- <span class=nt>labelSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>                    </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w>                      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;app.kubernetes.io/name&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w>                        </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w>                        </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w>                          </span>- <span class=s2>&#34;vmstorage&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w>                  </span><span class=nt>topologyKey</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kubernetes.io/hostname&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=w>          </span><span class=nt>topologySpreadConstraints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=w>            </span>- <span class=nt>labelSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=w>                </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=w>                  </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class=l>vmstorage</span><span class=w>
</span></span></span><span class=line><span class=ln>32</span><span class=cl><span class=w>              </span><span class=nt>maxSkew</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=ln>33</span><span class=cl><span class=w>              </span><span class=nt>topologyKey</span><span class=p>:</span><span class=w> </span><span class=l>topology.kubernetes.io/zone</span><span class=w>
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=w>              </span><span class=nt>whenUnsatisfiable</span><span class=p>:</span><span class=w> </span><span class=l>ScheduleAnyway</span><span class=w>
</span></span></span><span class=line><span class=ln>35</span><span class=cl><span class=w>        </span><span class=nt>vmselect</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>36</span><span class=cl><span class=w>          </span><span class=nt>storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=w>            </span><span class=nt>volumeClaimTemplate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>38</span><span class=cl><span class=w>              </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gp3&#34;</span><span class=w>
</span></span></span></code></pre></div><p>&#8505;&#xfe0f; It's worth noting that some of these parameters follow Kubernetes best practices, especially when using <a href=https://karpenter.sh/>Karpenter</a>: <code>topologySpreadConstraints</code> helps distribute pods across different zones, and <code>podAntiAffinity</code> ensures that two pods for the same service do not end up on the same node.</p><h2 id=-configuration>🛠️ Configuration</h2><p>Alright, VictoriaMetrics is now deployed 👏. It's time to <strong>configure</strong> the monitoring for our applications, and for this, we'll rely on the Kubernetes operator pattern.
Actually, this means declaring c<a href=https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/>Custom Resources</a> that will be consumed by the <a href=https://github.com/VictoriaMetrics/operator><strong>VictoriaMetrics Operator</strong></a> to configure and manage VictoriaMetrics.</p><p>The Helm chart we used doesn't directly deploy VictoriaMetrics, but instead primarily installs the operator. This operator is responsible for creating and managing custom resources such as <code>VMSingle</code> or <code>VMCluster</code>, which define how VictoriaMetrics is deployed and configured based on the needs.</p><p>The role of <code>VMServiceScrape</code> is to declare <strong>where to scrape metrics</strong> for a given service. It relies on Kubernetes labels to identify the proper service and port.</p><p><a href=https://github.com/Smana/cloud-native-ref/blob/main/observability/base/victoria-metrics-k8s-stack/vmservicecrapes/karpenter.yaml>observability/base/victoria-metrics-k8s-stack/vmservicecrapes/karpenter.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>operator.victoriametrics.com/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>VMServiceScrape</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>karpenter</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>karpenter</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>      </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class=l>karpenter</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>  </span><span class=nt>endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=l>http-metrics</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/metrics</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>  </span><span class=nt>namespaceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>    </span><span class=nt>matchNames</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>      </span>- <span class=l>karpenter</span><span class=w>
</span></span></span></code></pre></div><p>We can verify that the parameters are correctly configured using <code>kubectl</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=ln>1</span><span class=cl><span class=go>kubectl get services -n karpenter --selector app.kubernetes.io/name=karpenter -o yaml | grep -A 4 ports
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=go>    ports:
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=go>    - name: http-metrics
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=go>      port: 8000
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=go>      protocol: TCP
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=go>      targetPort: http-metrics
</span></span></span></code></pre></div><p>Sometimes there is no service, in which case we can specify how to identify the pods directly using <code>VMPodScrape</code>.</p><p><a href=https://github.com/Smana/cloud-native-ref/blob/main/observability/base/flux-config/observability/vmpodscrape.yaml>observability/base/flux-config/observability/vmpodscrape.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>operator.victoriametrics.com/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>VMPodScrape</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flux-system</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>flux-system</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>namespaceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=nt>matchNames</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>      </span>- <span class=l>flux-system</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>        </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>        </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>          </span>- <span class=l>helm-controller</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>          </span>- <span class=l>source-controller</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>          </span>- <span class=l>kustomize-controller</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>          </span>- <span class=l>notification-controller</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>          </span>- <span class=l>image-automation-controller</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>          </span>- <span class=l>image-reflector-controller</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>  </span><span class=nt>podMetricsEndpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>    </span>- <span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=l>http-prom</span><span class=w>
</span></span></span></code></pre></div><p>Not all of our applications are necessarily deployed on Kubernetes. The <code>VMScrapeConfig</code> resource in VictoriaMetrics allows the use of several "<a href=https://docs.victoriametrics.com/sd_configs/index.html>Service Discovery</a>" methods. This resource offers flexibility in defining how to scrape targets via different discovery mechanisms, such as EC2 instances (AWS), cloud services, or other systems.</br>In the example below, we use the custom tag <code>observability:node-exporter</code> and apply label transformations, allowing us to collect metrics exposed by <a href=https://github.com/prometheus/node_exporter>node-exporters</a> installed on these instances.</p><p><a href=https://github.com/Smana/cloud-native-ref/blob/main/observability/base/victoria-metrics-k8s-stack/vmscrapeconfigs/ec2.yaml>observability/base/victoria-metrics-k8s-stack/vmscrapeconfigs/ec2.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>operator.victoriametrics.com/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>VMScrapeConfig</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>aws-ec2-node-exporter</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>observability</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>ec2SDConfigs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span>- <span class=nt>region</span><span class=p>:</span><span class=w> </span><span class=l>${region}</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>9100</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>      </span><span class=nt>filters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>tag:observability:node-exporter</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>          </span><span class=nt>values</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;true&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>  </span><span class=nt>relabelConfigs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>replace</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>      </span><span class=nt>source_labels</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>__meta_ec2_tag_Name]</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>      </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class=l>ec2_name</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>replace</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>      </span><span class=nt>source_labels</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>__meta_ec2_tag_app]</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>      </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class=l>ec2_application</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>replace</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>      </span><span class=nt>source_labels</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>__meta_ec2_availability_zone]</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>      </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class=l>ec2_az</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>replace</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w>      </span><span class=nt>source_labels</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>__meta_ec2_instance_id]</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w>      </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class=l>ec2_id</span><span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>replace</span><span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w>      </span><span class=nt>source_labels</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>__meta_ec2_region]</span><span class=w>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=w>      </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class=l>ec2_region</span><span class=w>
</span></span></span></code></pre></div><p>ℹ️ If you were already using the Prometheus Operator, migrating to VictoriaMetrics is very simple because it is fully <strong>compatible</strong> with the CRDs defined by the Prometheus Operator.</p><h2 id=-visualizing-metrics-with-the-grafana-operator>📈 Visualizing Metrics with the Grafana Operator</h2><p>It's easy to guess what the Grafana Operator does: It uses Kubernetes resources to configure Grafana 😝. It allows you to deploy Grafana instances, add datasources, import dashboards from various sources (URL, JSON), organize them into folders, and more...</br>This offers an alternative to defining everything in the Helm chart or using configmaps, and in my opinion, provides better readability. In this example, I group all the resources related to monitoring Cilium.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>tree  infrastructure/base/cilium/
</span></span><span class=line><span class=ln>2</span><span class=cl>infrastructure/base/cilium/
</span></span><span class=line><span class=ln>3</span><span class=cl>├── grafana-dashboards.yaml
</span></span><span class=line><span class=ln>4</span><span class=cl>├── grafana-folder.yaml
</span></span><span class=line><span class=ln>5</span><span class=cl>├── httproute-hubble-ui.yaml
</span></span><span class=line><span class=ln>6</span><span class=cl>├── kustomization.yaml
</span></span><span class=line><span class=ln>7</span><span class=cl>├── vmrules.yaml
</span></span><span class=line><span class=ln>8</span><span class=cl>└── vmservicescrapes.yaml
</span></span></code></pre></div><p>Defining the <code>Folder</code> is super straightforward.</p><p><a href=https://github.com/Smana/cloud-native-ref/blob/main/observability/base/infrastructure/cilium/grafana-folder.yaml>observability/base/infrastructure/cilium/grafana-folder.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>grafana.integreatly.org/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>GrafanaFolder</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cilium</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w>  </span><span class=nt>allowCrossNamespaceImport</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w>  </span><span class=nt>instanceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>9</span><span class=cl><span class=w>      </span><span class=nt>dashboards</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;grafana&#34;</span><span class=w>
</span></span></span></code></pre></div><p>Here is a <code>Dashboard</code> resource that fetches the configuration from an HTTP link. We can also use dashboards available from the <a href=https://grafana.com/grafana/dashboards/>Grafana website</a> by specifying the appropriate ID, or simply provide the definition in JSON format.</p><p><a href=https://github.com/Smana/cloud-native-ref/blob/main/observability/base/infrastructure/cilium/grafana-dashboards.yaml>observability/base/infrastructure/cilium/grafana-dashboards.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>grafana.integreatly.org/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>GrafanaDashboard</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cilium-cilium</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>  </span><span class=nt>folderRef</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;cilium&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>allowCrossNamespaceImport</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span><span class=nt>datasources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span>- <span class=nt>inputName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;DS_PROMETHEUS&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>      </span><span class=nt>datasourceName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;VictoriaMetrics&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>  </span><span class=nt>instanceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>      </span><span class=nt>dashboards</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;grafana&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>  </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://raw.githubusercontent.com/cilium/cilium/main/install/kubernetes/cilium/files/cilium-agent/dashboards/cilium-dashboard.json&#34;</span><span class=w>
</span></span></span></code></pre></div><p>Note that I chose <strong>not to use the Grafana Operator to deploy the instance</strong>, but to keep the one installed via the VictoriaMetrics Helm chart. Therefore, we have to tell to the Grafana Operator where are the <strong>credentials</strong> so it can apply changes to this instance.</p><p><a href=https://github.com/Smana/cloud-native-ref/blob/main/observability/base/grafana-operator/grafana-victoriametrics.yaml>observability/base/grafana-operator/grafana-victoriametrics.yaml</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>grafana.integreatly.org/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Grafana</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>grafana-victoriametrics</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=nt>dashboards</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;grafana&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span><span class=nt>external</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>http://victoria-metrics-k8s-stack-grafana</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>    </span><span class=nt>adminPassword</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>victoria-metrics-k8s-stack-grafana-admin</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>admin-password</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>    </span><span class=nt>adminUser</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>victoria-metrics-k8s-stack-grafana-admin</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>admin-user</span><span class=w>
</span></span></span></code></pre></div><p>Finally, we can use Grafana and explore our various dashboards 🎉!</p><center><video id=Grafana controls height=800 autoplay loop muted>
<source src=grafana.webm type=video/webm>Your browser does not support the video tag.</video></center><script>var video=document.getElementById("Grafana");video.playbackRate=1.3</script><h2 id=-final-thoughts>💭 Final Thoughts</h2><p>Based on the various articles reviewed, one of the main reasons to migrate to or choose VictoriaMetrics is generally <strong>better performances</strong>. However, it’s wise to remain cautious, as benchmark results depend on several factors and the specific goals in mind. This is why it's highly recommended to run your own tests. VictoriaMetrics provides a <a href=https://github.com/VictoriaMetrics/prometheus-benchmark>benchmarking tool</a> that can be used on Prometheus-compatible TSDBs.</p><p>As you can see, today my preference is for VictoriaMetrics for metrics collection, as I appreciate the modular architecture with a variety of combinations depending on the <strong>evolving needs</strong>. However, a solution using the Prometheus Operator works perfectly fine in most cases and has the advantage of being governed by a foundation.</p><p>Additionally, it's important to note that some features are only available in the <a href=https://docs.victoriametrics.com/enterprise/><strong>Enterprise version</strong></a>, such as downsampling, which is highly useful when wanting to retain a large amount of data over the long term.</p><p>In this article, we highlighted the <strong>ease of implementation</strong> to achieve a solution that efficiently collects and visualizes metrics. This is done while using the Kubernetes operator pattern,the "GitOps way", allowing the declaration of various resources through Custom Resources. For instance, a developer can easily include a <code>VMServiceScrape</code> and a <code>VMRule</code> in their manifests, thus embedding the observability culture within the application delivery processes.</p><p>Having metrics is great, but is it enough? We'll try to answer that in the upcoming articles...</p><h2 id=-references>🔖 References</h2><ul><li><a href=https://docs.victoriametrics.com/articles/>Articles sur VictoriaMetrics</a></li></ul></div><h2 class=post_related>Posts in this series</h2><ul></ul><div class=post_comments></div><div class=post_i18n><h3 class=mb-0>Translations:</h3><nav class=tags_nav><a href=https://blog.ogenki.io/fr/post/series/observability/metrics/ class="post_tag button button_translucent">Français</a></nav></div></article><aside class=sidebar><section class=sidebar_inner><br><div class=search><input type=search class="search_field form_field" placeholder=Search... id=find autocomplete=off data-scope=post>
<label for=find class=search_label><svg class="icon"><title>search</title><use xlink:href="#search"/></svg></label><div class="search_results results"></div></div><div class=author_header><img src=https://blog.ogenki.io/images/smana.jpg alt="Smaine Kahlouch photo"><h2>Smaine Kahlouch</h2></div><div class=author_bio>Lead SRE/DevOps, Team leader, Open Source enthusiast.</div><a href=https://blog.ogenki.io/about/ class="button mt-1" role=button title='Read More'>Read More</a><h2 class=mt-4>Posts in this series</h2><ul></ul><h2 class=mt-4>Featured Posts</h2><ul><li><a href=https://blog.ogenki.io/post/series/observability/logs/ class=nav-link title="`VictoriaLogs`: What if logs management became simple and performant?"><code>VictoriaLogs</code>: What if logs management became simple and performant?</a></li><li><a href=https://blog.ogenki.io/post/series/observability/alerts/ class=nav-link title="`VictoriaMetrics` : Effective alerts, from theory to practice 🛠️"><code>VictoriaMetrics</code> : Effective alerts, from theory to practice 🛠️</a></li><li><a href=https://blog.ogenki.io/post/series/observability/metrics/ class=nav-link title="Harness the Power of `VictoriaMetrics` and `Grafana` Operators for Metrics Management">Harness the Power of <code>VictoriaMetrics</code> and <code>Grafana</code> Operators for Metrics Management</a></li><li><a href=https://blog.ogenki.io/post/pki-gapi/ class=nav-link title="`TLS` with Gateway API: Efficient and Secure Management of Public and Private Certificates"><code>TLS</code> with Gateway API: Efficient and Secure Management of Public and Private Certificates</a></li></ul><h2 class=mt-4>Recent Posts</h2><ul class=flex-column><li><a href=https://blog.ogenki.io/post/dagger-intro/ class=nav-link title="`Dagger`: The missing piece of the developer experience?"><code>Dagger</code>: The missing piece of the developer experience?</a></li><li><a href=https://blog.ogenki.io/post/crossplane_composition_functions/ class=nav-link title="Going Further with `Crossplane`: Compositions and Functions">Going Further with <code>Crossplane</code>: Compositions and Functions</a></li><li><a href=https://blog.ogenki.io/post/tailscale/ class=nav-link title="Beyond Traditional VPNs: Simplifying Cloud Access with `Tailscale`">Beyond Traditional VPNs: Simplifying Cloud Access with <code>Tailscale</code></a></li><li><a href=https://blog.ogenki.io/post/cilium-gateway-api/ class=nav-link title="`Gateway API`: Can I replace my Ingress Controller with `Cilium`?"><code>Gateway API</code>: Can I replace my Ingress Controller with <code>Cilium</code>?</a></li><li><a href=https://blog.ogenki.io/post/terraform-controller/ class=nav-link title="Applying GitOps Principles to Infrastructure: An overview of `tf-controller`">Applying GitOps Principles to Infrastructure: An overview of <code>tf-controller</code></a></li><li><a href=https://blog.ogenki.io/post/cnpg/ class=nav-link title="`CloudNativePG`: An easy way to run PostgreSQL on Kubernetes"><code>CloudNativePG</code>: An easy way to run PostgreSQL on Kubernetes</a></li><li><a href=https://blog.ogenki.io/post/devflux/ class=nav-link title="100% `GitOps` using Flux">100% <code>GitOps</code> using Flux</a></li><li><a href=https://blog.ogenki.io/post/crossplane_k3d/ class=nav-link title="My Kubernetes cluster (GKE) with `Crossplane`">My Kubernetes cluster (GKE) with <code>Crossplane</code></a></li></ul><div><h2 class="mt-4 taxonomy" id=categories-section>Categories</h2><nav class=tags_nav><a href=https://blog.ogenki.io/categories/containers/ class="post_tag button button_translucent" title=containers>CONTAINERS
<span class=button_tally>7</span>
</a><a href=https://blog.ogenki.io/categories/devxp/ class="post_tag button button_translucent" title=devxp>DEVXP
<span class=button_tally>6</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=series-section>Series</h2><nav class=tags_nav><a href=https://blog.ogenki.io/series/workshop-kubernetes/ class="post_tag button button_translucent" title="workshop kubernetes">WORKSHOP KUBERNETES
<span class=button_tally>7</span>
</a><a href=https://blog.ogenki.io/series/workshop-helm/ class="post_tag button button_translucent" title="workshop helm">WORKSHOP HELM
<span class=button_tally>6</span>
</a><a href=https://blog.ogenki.io/series/observability/ class="post_tag button button_translucent" title=observability>OBSERVABILITY
<span class=button_tally>3</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=tags-section>Tags</h2><nav class=tags_nav><a href=https://blog.ogenki.io/tags/kubernetes/ class="post_tag button button_translucent" title=kubernetes>KUBERNETES
<span class=button_tally>15</span>
</a><a href=https://blog.ogenki.io/tags/helm/ class="post_tag button button_translucent" title=helm>HELM
<span class=button_tally>6</span>
</a><a href=https://blog.ogenki.io/tags/infrastructure/ class="post_tag button button_translucent" title=infrastructure>INFRASTRUCTURE
<span class=button_tally>4</span>
</a><a href=https://blog.ogenki.io/tags/devxp/ class="post_tag button button_translucent" title=devxp>DEVXP
<span class=button_tally>3</span>
</a><a href=https://blog.ogenki.io/tags/observability/ class="post_tag button button_translucent" title=observability>OBSERVABILITY
<span class=button_tally>3</span>
</a><a href=https://blog.ogenki.io/tags/gitops/ class="post_tag button button_translucent" title=gitops>GITOPS
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/network/ class="post_tag button button_translucent" title=network>NETWORK
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/security/ class="post_tag button button_translucent" title=security>SECURITY
<span class=button_tally>2</span>
</a><a href=https://blog.ogenki.io/tags/data/ class="post_tag button button_translucent" title=data>DATA
<span class=button_tally>1</span>
</a><a href=https://blog.ogenki.io/tags/index/ class="post_tag button button_translucent" title=index>INDEX
<span class=button_tally>1</span>
</a><a href=https://blog.ogenki.io/tags/local/ class="post_tag button button_translucent" title=local>LOCAL
<span class=button_tally>1</span>
</a><a href=https://blog.ogenki.io/tags/tooling/ class="post_tag button button_translucent" title=tooling>TOOLING
<span class=button_tally>1</span></a></nav></div></section></aside></div></main><svg width="0" height="0" class="hidden"><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter"><path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68.0 01-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043.0-1.924.366-2.643 1.078A3.56 3.56.0 008.766 5.383c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846.0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47.0.929.273 1.705.82 2.388a3.623 3.623.0 002.115 1.291c-.312.08-.641.118-.979.118-.312.0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652.0 002.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422.0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139.0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77.0 001.172-4.892v-.468a7.788 7.788.0 001.84-1.921 8.142 8.142.0 01-2.11.593z"/></symbol><symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar"><path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916.0 1e2v352c0 33.084 26.916 60 60 60h392c33.084.0 60-26.916 60-60V1e2c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028.0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028.0 20 8.972 20 20v48z"/><path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github"><path d="M255.968 5.329C114.624 5.329.0 120.401.0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384.0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008.0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992.0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584.0 34.368-.32 62.08-.32 70.496.0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab"><path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6.0L12.3 74.8z"/><path d="M12.3 74.7.5 111c-1 3.2.0 6.8 3 8.8l101.6 74-92.5-119z"/><path d="M105 193.7l-38.6-119h-54l92.7 119z"/><path d="M105 193.7l38.7-119H66.4l38.7 119z"/><path d="M105 193.7l38.7-119H198l-93 119z"/><path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/><path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6.0L198 74.8z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss"><circle cx="3.429" cy="20.571" r="3.429"/><path d="M11.429 24h4.57C15.999 15.179 8.821 8.001.0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"/><path d="M24 24C24 10.766 13.234.0.0.0v4.571c10.714.0 19.43 8.714 19.43 19.429z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h362c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top"><path d="M604.501 440.509 325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298.0 36.323s26.223 10.024 36.222.0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221.0 9.999-10.023 9.999-26.298.0-36.323z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly"><path d="M504.971 239.029 448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c19.851.0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002.0 004e2 320v108c0 19.851-16.149 36-36 36h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c46.318.0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568.0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255.0 24-10.745 24-24S205.255.0 192 0h-44c-46.318.0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568.0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255.0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851.0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002.0 00112 192z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy"><path d="M23 2.75A2.75 2.75.0 0020.25.0H8.75A2.75 2.75.0 006 2.75v13.5A2.75 2.75.0 008.75 19h11.5A2.75 2.75.0 0023 16.25zM18.25 14.5h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5z"/><path d="M8.75 20.5A4.255 4.255.0 014.5 16.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752.0 001 5.25v16A2.752 2.752.0 003.75 24h12a2.752 2.752.0 002.75-2.75v-.75z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme"><path d="M284.286 256.002 506.143 34.144c7.811-7.811 7.811-20.475.0-28.285-7.811-7.81-20.475-7.811-28.285.0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285.0-7.81 7.811-7.811 20.475.0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475.0 28.285a19.938 19.938.0 0014.143 5.857 19.94 19.94.0 0014.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475.0-28.285L284.286 256.002z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu"><path d="M492 236H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954.0 96s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram"><path d="M12 2.163c3.204.0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849.0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204.0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849.0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741.0 8.333.014 7.053.072c-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.668.072 4.948c.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24s3.668-.014 4.948-.072c4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403.0-6.162 2.759-6.162 6.162S8.597 18.163 12 18.163s6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zM12 16c-2.209.0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796.0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795.0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="youtube"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow"><path d="M21 27v-8h3v11H0V19h3v8h18z"/><path d="M17.1.2 15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8 13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord"><path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527.41542 45.5603.39851 45.468.440769 45.4204.525289 44.7963 1.6353 44.105 3.0834 43.6209 4.2216c-5.4572-.817-10.8864-.817-16.2317.0C26.905 3.0581 26.1886 1.6353 25.5617.525289 25.5141.443589 25.4218.40133 25.3294.41542c-5.071.87338-9.9237 2.40318-14.4518 4.48238C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795 1.57795 18.7309-.943561 32.1443.293408 45.3914.299005 45.4562.335386 45.5182.385761 45.5576 6.45866 50.0174 12.3413 52.7249 18.1147 54.5195 18.2071 54.5477 18.305 54.5139 18.3638 54.4378 19.7295 52.5728 20.9469 50.6063 21.9907 48.5383 22.0523 48.4172 21.9935 48.2735 21.8676 48.2256 19.9366 47.4931 18.0979 46.6 16.3292 45.5858 16.1893 45.5041 16.1781 45.304 16.3068 45.2082 16.679 44.9293 17.0513 44.6391 17.4067 44.3461 17.471 44.2926 17.5606 44.2813 17.6362 44.3151c11.6196 5.3051 24.1992 5.3051 35.6817.0C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433 53.9057 44.6363 54.2779 44.9293 54.6529 45.2082 54.7816 45.304 54.7732 45.5041 54.6333 45.5858c-1.7687 1.0339-3.6074 1.9073-5.5412 2.637C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383c1.0662 2.0651 2.2836 4.0316 3.6241 5.8967C52.6519 54.5139 52.7526 54.5477 52.845 54.5195c5.8014-1.7946 11.684-4.5021 17.7569-8.9619C70.6551 45.5182 70.6887 45.459 70.6943 45.3942 72.1747 30.0791 68.2147 16.7757 60.1968 4.9823 60.1772 4.9429 60.1437 4.9147 60.1045 4.8978zM23.7259 37.3253c-3.4983.0-6.3808-3.2117-6.3808-7.156s2.8266-7.156 6.3808-7.156c3.5821.0 6.4367 3.2399 6.3807 7.156.0 3.9443-2.8266 7.156-6.3807 7.156zm23.5919.0c-3.4982.0-6.3807-3.2117-6.3807-7.156s2.8265-7.156 6.3807-7.156c3.5822.0 6.4367 3.2399 6.3808 7.156.0 3.9443-2.7986 7.156-6.3808 7.156z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 18" id="mastodon"><path fill="#fff" d="m15.054695 9.8859583c-.22611 1.1632697-2.02517 2.4363497-4.09138 2.6830797-1.0774504.12856-2.1382704.24673-3.2694704.19484-1.84996-.0848-3.30971-.44157-3.30971-.44157.0.1801.0111.35157.0333.51194.24051 1.82571 1.81034 1.93508 3.29737 1.98607 1.50088.0514 2.8373104-.37004 2.8373104-.37004l.0617 1.35686s-1.0498104.56374-2.9199404.66742c-1.03124.0567-2.3117-.0259-3.80308-.42069-3.23454998-.85613-3.79081998-4.304-3.87592998-7.8024197-.026-1.03871-.01-2.01815-.01-2.83732.0-3.57732 2.34385998-4.62587996 2.34385998-4.62587996 1.18184-.54277 3.20976-.77101 5.318-.7882499985409h.0518C9.8267646.01719834 11.856025.24547834 13.037775.78824834c0 0 2.34377 1.04855996 2.34377 4.62587996.0.0.0294 2.63937-.32687 4.47183"/><path fill="#000" d="m12.616925 5.6916583v4.3315297h-1.71607V5.8189683c0-.88624-.37289-1.33607-1.1187604-1.33607-.82467.0-1.23799.53361-1.23799 1.58875v2.30122h-1.70594v-2.30122c0-1.05514-.4134-1.58875-1.23808-1.58875-.74587.0-1.11876.44983-1.11876 1.33607v4.2042197h-1.71607V5.6916583c0-.88527.22541-1.58876.67817-2.10922.46689-.52047 1.07833-.78727 1.83735-.78727.87816.0 1.54317.33752 1.98288 1.01267l.42744.71655.42753-.71655c.43961-.67515 1.10463-1.01267 1.9828704-1.01267.75893.0 1.37037.2668 1.83735.78727.45268.52046.67808 1.22395.67808 2.10922"/></symbol></svg><footer class=footer><div class="footer_inner wrap pale"><img src=https://blog.ogenki.io/icons/footer.png class="icon icon_2 transparent" alt="Copyright © 2021–2023, Smana https://github.io/Smana"><p>Copyright&nbsp;<span class=year></span>&nbsp;COPYRIGHT © 2021–2023, SMANA HTTPS://GITHUB.IO/SMANA. All Rights Reserved</p><a class=to_top href=#documentTop><svg class="icon"><title>to-top</title><use xlink:href="#to-top"/></svg></a></div></footer><script type=text/javascript src=https://blog.ogenki.io/en/js/bundle.fb0be5bcaafc43d845951fd0966e48e5a7bf36be99ce2176c89d369bb5a8136dfb14e596d145cfa04c4c3b79232ffffd811a01eccee956d9d61cf49330e633c7.js integrity="sha512-+wvlvKr8Q9hFlR/Qlm5I5ae/Nr6ZziF2yJ02m7WoE237FOWW0UXPoExMO3kjL//9gRoB7M7pVtnWHPSTMOYzxw==" crossorigin=anonymous></script><script src=https://blog.ogenki.io/js/search.min.73cb82d8f274395dd220d6594053cd3d3d8ac8c97d874b5142a60b9744f3704d765551e0ade104d5803c66b731f5a7a00ac2cff33c8c9090ff8100169a3e2574.js></script></body></html>